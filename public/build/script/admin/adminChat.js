let socket;function gptSendMessage(){var e=document.getElementById("gptInput"),t=e.value??"";""!==t.trim()&&(addMessageItem({role:"user",message:t}),e.value="",SnLoadingState(!0,"jsGptAction","gptSend"),RequestApi.fetch("/admin/chatGpt/sendMessage",{method:"POST",body:{message:t}}).then(e=>{e.success?e.result.forEach(e=>{addMessageItem(e)}):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsGptAction","gptSend")}))}function addMessageItem(e){var t=document.getElementById("gptMessage"),s=document.getElementById("gptContent");let n=marked.parse(e.message);var a=document.createElement("div");a.classList.add("Gpt-message-item"),n="user"===e?.role?(a.classList.add("user"),'<div style="display: flex;"><div class="SnAvatar SnMr-2"><span class="SnAvatar-text">TU</span></div><div>Tu</div></div>'+n):(a.classList.add("gpt"),'<div style="display: flex;"><div class="SnAvatar SnMr-2"><span class="SnAvatar-text">GPT</span></div><div>ChatGPT</div></div>'+n),a.insertAdjacentHTML("beforeend",n),t.appendChild(a),s.scrollTop=s.scrollHeight}function openGptPanel(){var e=document.getElementById("AdminLayout"),t=document.getElementById("gptMessage");e.classList.add("PanelRight-is-show"),t.innerHTML="",RequestApi.fetch("/admin/chatGpt/loadMessage").then(e=>{e.success?e.result.reverse().forEach(e=>{addMessageItem(e)}):dynamicResponseErrorModalMessage(e)})}function chearThread(){SnLoadingState(!0,"jsGptAction","gptSend"),RequestApi.fetch("/admin/chatGpt/deleteThread").then(e=>{e.success?(SnMessage.success({content:result.sunat.message}),openGptPanel()):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsGptAction","gptSend")})}document.addEventListener("DOMContentLoaded",()=>{var e=document.getElementById("gptInput");e.addEventListener("keypress",function(e){"Enter"===e.key&&e.preventDefault()}),e.addEventListener("keyup",function(e){"Enter"===e.key&&(e.preventDefault(),gptSendMessage())})});