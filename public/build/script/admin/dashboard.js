let saleChart,salePaymentChart,incomeExpenseChart,dateTypeString={day:"Dia",month:"Mes",year:"AÃ±o"};function generateSVGString(e){var t=2*Math.PI*35;return`
    <svg class="radial-progress" data-percentage="${e}" viewBox="0 0 80 80">
      <circle class="incomplete" cx="40" cy="40" r="35" stroke="#eee" stroke-width="5"></circle>
      <circle class="complete" cx="40" cy="40" r="35" stroke="#3498db" stroke-width="5" stroke-dasharray="${t}" stroke-dashoffset="${t-e/100*t}" stroke-linecap="round" transform="rotate(-90 40 40)"></circle>
      <text class="percentage" x="50%" y="50%" dominant-baseline="central" text-anchor="middle" font-size="14" transform="translate(0, 4)">${e}%</text>
    </svg>
  `}function daysInMonth(e,t){var a=[],n=new Date(e,t,0).getDate();for(let e=1;e<=n;e++){var o=("00"+e).slice(-2);a.push(o)}return a}function hoursInDay(){var t=[];for(let e=0;e<24;e++){var a=("00"+e).slice(-2)+".00";t.push(a)}return t}function reportSale(){let t={};t.currencyId=operability.currency_id,t.dateType=document.getElementById("dashDateType").value,t.date=document.getElementById("dashDate").value,SnLoadingState(!0,"jsAction"),RequestApi.fetch("/admin/report/saleDashboard",{method:"POST",body:t}).then(e=>{e.success?reportSaleBuild(e.result,t.date):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction")})}function reportSaleBuild(e,t){var a=e.currency.symbol,n=document.getElementById("dashDateType").value;document.getElementById("saleDayTotalTitle").innerHTML=dayjs(t).format("D [DE] MMMM"),document.getElementById("saleMonthTotalTitle").innerHTML=dayjs(t).format("MMMM [DE] YYYY"),document.getElementById("saleYearTotalTitle").innerHTML=dayjs(t).format("YYYY"),document.getElementById("saleDayTotal").innerHTML=a+" "+parseFloat(e.sale_day_total??0).toFixed(2),document.getElementById("saleMonthTotal").innerHTML=a+" "+parseFloat(e.sale_month_total??0).toFixed(2),document.getElementById("saleYearTotal").innerHTML=a+" "+parseFloat(e.sale_year_total??0).toFixed(2),document.getElementById("saleTotal").innerHTML=a+" ("+parseFloat(e.sale_total??0).toFixed(2)+")",document.getElementById("saleCount").innerHTML=parseFloat(e.sale_count??0),document.getElementById("saleCancelTotal").innerHTML=a+" ("+parseFloat(e.sale_cancel_total??0).toFixed(2)+")",document.getElementById("saleCancelCount").innerHTML=parseFloat(e.sale_cancel_count??0),buildSaleChart({currencySymbol:a,dateType:n,invoiceSummaries:e.sale_invoice_summaries,invoiceTicketSummaries:e.sale_invoice_tiket_summaries,ticketSummaries:e.sale_tiket_summaries}),buildIncomeExpenseChart(a,e.expense_total,e.income_total),buildSalePaymentChart(a,e.sale_payment_summary),buildBestSellers(e.best_sellers),buildHigherProfits(e.higher_profits)}function buildSaleChart({currencySymbol:e,dateType:t,invoiceSummaries:a,invoiceTicketSummaries:n,ticketSummaries:o}){let r=[];r="year"===t?["ene.","feb.","mar.","abr.","may.","jun.","jul.","ago.","set.","oct.","nov.","dic."]:"month"==t?daysInMonth(dayjs().format("YYYY"),dayjs().format("MM")):hoursInDay();var l=[];let d=0,s=0,i=0,m={label:"Factura",borderColor:"#EA3D14",backgroundColor:"rgba(234, 61, 20, .3)",data:[]};a.forEach(e=>{m.data.push({x:"year"===t?dayjs(e.g_date).format("MMM"):e.g_date,y:parseFloat(e.total)}),d+=parseFloat(e.total)}),l.push(m),m={label:"Boleta",borderColor:"#6479D5",backgroundColor:"rgba(100, 121, 213, .3)",data:[]},n.forEach(e=>{m.data.push({x:"year"===t?dayjs(e.g_date).format("MMM"):e.g_date,y:parseFloat(e.total)}),s+=parseFloat(e.total)}),l.push(m),m={label:"Ticket",borderColor:"#4FA63E",backgroundColor:"rgba(79, 166, 62, .3)",data:[]},o.forEach(e=>{m.data.push({x:"year"===t?dayjs(e.g_date).format("MMM"):e.g_date,y:parseFloat(e.total)}),i+=parseFloat(e.total)}),l.push(m),saleChart.data.labels=r,saleChart.data.datasets=l,saleChart.update();a=(d+s+i).toFixed(2);document.getElementById("dashSaleDocumentType2Total").innerHTML=e+" "+d.toFixed(2),document.getElementById("dashSaleDocumentType3Total").innerHTML=e+" "+s.toFixed(2),document.getElementById("dashSaleDocumentType1Total").innerHTML=e+" "+i.toFixed(2),document.getElementById("dashSaleTotal").innerHTML=e+" "+a,document.getElementById("saleChartTitle").innerHTML="Ventas por "+dateTypeString[t]}function buildIncomeExpenseChart(e,t,a){incomeExpenseChart.data={labels:["SALDA","ENTRADA"],datasets:[{label:"Movimiento",data:[t,a],backgroundColor:["rgb(255, 99, 132)","rgb(54, 162, 235)"],hoverOffset:4}]},incomeExpenseChart.update(),document.getElementById("movementIncome").innerHTML=e+" "+parseFloat(a).toFixed(2),document.getElementById("movementExpense").innerHTML=e+" "+parseFloat(t).toFixed(2)}function buildSalePaymentChart(e,t){var a=t.find(e=>1==e.payment_method_id)?.total??0,n=t.find(e=>2==e.payment_method_id)?.total??0,o=t.find(e=>3==e.payment_method_id)?.total??0,r=t.find(e=>5==e.payment_method_id)?.total??0,t=t.find(e=>6==e.payment_method_id)?.total??0,l=(a=parseFloat(a))+(n=parseFloat(n))+(o=parseFloat(o))+(r=parseFloat(r))+(t=parseFloat(t)),d=parseFloat(0<a?a/l*100:0),s=parseFloat(0<n?n/l*100:0),i=(parseFloat(0<o?o/l*100:0),parseFloat(0<r?r/l*100:0)),m=parseFloat(0<t?t/l*100:0);salePaymentChart.data={labels:["Efectivo","Tarjeta","Vale","Deposito","App"],datasets:[{label:"Movimiento",data:[a,n,o,r,t],backgroundColor:["rgb(255, 99, 132)","rgb(54, 162, 235)","rgb(153, 102, 255)","rgb(255, 159, 64)","rgb(75, 192, 192)"],borderWidth:0}]},salePaymentChart.update(),document.getElementById("salePaymentCash").innerHTML=d.toFixed(2)+"%",document.getElementById("salePaymentCard").innerHTML=s.toFixed(2)+"%",document.getElementById("salePaymentBanck").innerHTML=i.toFixed(2)+"%",document.getElementById("salePaymentApp").innerHTML=m.toFixed(2)+"%",document.getElementById("salePaymentTotal").innerHTML=`${e} ${l.toFixed(2)} | 100%`}function buildBestSellers(e){const t=document.getElementById("dashBestSellers");t.innerHTML="",e.map(e=>{t.insertAdjacentHTML("beforeend",`<tr>
                                                            <td>${e.description}</td>
                                                            <td>${e.total}</td>
                                                        </tr>`)})}function buildHigherProfits(e){const t=document.getElementById("dashHigherProfits");t.innerHTML="",e.map(e=>{t.insertAdjacentHTML("beforeend",`<tr>
                                                            <td>${e.description}</td>
                                                            <td>${e.total}</td>
                                                            <td>${e.purchase_total}</td>
                                                            <td>${e.utility}</td>
                                                        </tr>`)})}document.addEventListener("DOMContentLoaded",()=>{var e=document.getElementById("dashDate"),t=document.getElementById("dashDateType");e.addEventListener("change",()=>{reportSale()}),t.addEventListener("change",()=>{reportSale()}),saleChart=new Chart(document.getElementById("saleChart"),{type:"line",data:{},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}}}}),salePaymentChart=new Chart(document.getElementById("salePaymentChart"),{type:"pie",data:{},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!1}}}}),incomeExpenseChart=new Chart(document.getElementById("incomeExpenseChart"),{type:"bar",data:{},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!1}},scales:{y:{display:!1},x:{display:!1}}}}),reportSale()});