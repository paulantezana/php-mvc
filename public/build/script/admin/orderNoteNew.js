let pOrderNoteValidator,currentCurrencySymbol="";function newOrderNoteSubmit(){var e,t;pOrderNoteValidator.validate()?((e={}).pdfFormat=document.getElementById("orderNotePdfFormat").value,e.observation=document.getElementById("orderNoteObservation").value,e.documentNumber=document.getElementById("orderNoteDocumentNumber").value,e.socialReason=document.getElementById("orderNoteSocialReason").value,e.fiscalAddress=document.getElementById("orderNoteFiscalAddress").value,e.email=document.getElementById("orderNoteEmail").value,e.phone=document.getElementById("orderNotePhone").value,e.providerId=document.getElementById("orderNoteProviderId").value,e.identityDocumentId=document.getElementById("orderNoteIdentityDocumentId").value,e.totalFree=document.getElementById("orderNoteTotalFree").value,e.totalExportation=document.getElementById("orderNoteTotalExportation").value,e.totalDiscount=document.getElementById("orderNoteTotalDiscount").value,e.totalExonerated=document.getElementById("orderNoteTotalExonerated").value,e.totalUnaffected=document.getElementById("orderNoteTotalUnaffected").value,e.totalTaxed=document.getElementById("orderNoteTotalTaxed").value,e.totalIgv=document.getElementById("orderNoteTotalIgv").value,e.totalCharge=document.getElementById("orderNoteTotalCharge").value,e.totalValue=document.getElementById("orderNoteTotalValue").value,e.totalPlasticBagTax=document.getElementById("orderNoteTotalPlasticBagTax").value,e.total=document.getElementById("orderNoteTotal").value,e.currencyId=document.getElementById("orderNoteCurrencyId").value,e.orderNoteItems=[],t=document.getElementById("orderNoteItemTableBody"),e.orderNoteItems=[...t.children].map((e,t)=>{var e=e.id.split("_")[1],o=document.getElementById("product_unit_price_"+e).value,d=document.getElementById("product_affectation_igv_type_id_"+e).value,n=document.getElementById("product_quantity_"+e).value,r=document.getElementById("product_discount_"+e).value,a=document.getElementById("product_unit_value_"+e).value,l=document.getElementById("product_total_value_"+e).value,c=document.getElementById("product_igv_"+e).value;return{quantity:n,unitValue:a,unitPrice:o,discount:r,charge:0,affectationIgvTypeId:d,totalBaseIgv:document.getElementById("product_total_base_igv_"+e).value,igv:c,totalValue:l,total:document.getElementById("product_total_"+e).innerHTML,unitMeasureId:document.getElementById("product_sale_unit_measure_id_"+e).value,productId:e}}),orderNoteValidateProcess(e)&&(SnLoadingState(!0,"jsAction","newOrderNoteFormSubmit"),RequestApi.fetch("/admin/processOrderNote/save",{method:"POST",body:e}).then(e=>{e.success?(SnMessage.success({content:e.message}),iframePrintModal(e.result.customPdf),newOrderNoteClear()):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction","newOrderNoteFormSubmit")}))):dynamicFormSubmitInvalidMessage()}function orderNoteValidateProcess(e){return 0==e.orderNoteItems.lenght?(SnModal.warning({title:"ALERTA USUARIO",content:"Ingrese al menos un producto en los detalles"}),!1):0<e.total||(SnModal.warning({title:"ALERTA USUARIO",content:"El total no puede ser menor que 0"}),!1)}function searchProductByCode(e){SnLoadingState(!0,"jsAction"),RequestApi.fetch("/admin/maintenanceProduct/barCodeSearch",{method:"POST",body:{barCode:e}}).then(e=>{e.success?e.result?(SnMessage.success({content:"Producto encontrado"}),orderNoteAddItem(e.result.product)):SnMessage.warning({content:"No se encontró ningún producto"}):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction")})}function orderNoteAddItem(t){var e=document.getElementById("orderNoteItemTableBody"),o=document.getElementById("product_"+t.id);let d="";affectationIgvTypes.forEach(e=>{d+=`<option value="${e.id}">${e.description}</option>`}),o?(o=document.getElementById("product_quantity_"+t.id)).value=parseFloat(o.value)+1:(e.insertAdjacentHTML("beforeend",`<tr id="product_${t.id}">
                                                            <td>
                                                                <input id="product_quantity_${t.id}" min="1" type="number" class="SnForm-control" value="${t.quantity||1}" style="width: 80px">
                                                                <input type="hidden" class="SnForm-control" value="${t.barcode}">
                                                                <input id="product_sale_unit_measure_id_${t.id}" type="hidden" class="SnForm-control" value="${t.sale_unit_measure_id}">
                                                            </td>
                                                            <td>${t.description}</td>
                                                            <td id="product_stock_${t.id}">${parseFloat(t.stock)} ${t.sale_unit_measure_id_code}</td>
                                                            <td>
                                                                <input id="product_discount_${t.id}" min="0" type="number" class="SnForm-control" value="0" style="width: 80px">
                                                            </td>
                                                            <td>
                                                                <input id="product_unit_price_${t.id}" min="0" type="number" class="SnForm-control" value="${t.sale_price_1}">
                                                                <input id="product_unit_value_${t.id}" type="hidden" class="SnForm-control" value="${t.sale_price_1}">
                                                            </td>
                                                            <td>
                                                                <select id="product_affectation_igv_type_id_${t.id}" class="SnForm-control">${d}</select>
                                                                <input id="product_total_base_igv_${t.id}" type="hidden" class="SnForm-control" value="0">
                                                                <input id="product_igv_${t.id}" type="hidden" class="SnForm-control" value="0">
                                                                <input id="product_total_value_${t.id}" type="hidden" class="SnForm-control" value="0">
                                                            </td>
                                                            <td id="product_total_${t.id}"></td>
                                                            <td><button id="product_remove_${t.id}" class="SnBtn error icon radio" type="button"><i class="fas fa-trash"></i></button></td>
                                                        </tr>`),document.getElementById("product_quantity_"+t.id).addEventListener("change",e=>{orderNoteItemCalculate()}),document.getElementById("product_discount_"+t.id).addEventListener("change",e=>{orderNoteItemCalculate()}),document.getElementById("product_unit_price_"+t.id).addEventListener("change",e=>{orderNoteItemCalculate()}),document.getElementById("product_unit_value_"+t.id).addEventListener("change",e=>{orderNoteItemCalculate()}),document.getElementById("product_affectation_igv_type_id_"+t.id).addEventListener("change",e=>{orderNoteItemCalculate()}),document.getElementById("product_remove_"+t.id).addEventListener("click",e=>{orderNoteItemRemove(t.id)})),orderNoteItemCalculate()}function orderNoteItemRemove(e){document.getElementById("product_"+e).remove(),orderNoteItemCalculate()}function orderNoteItemCalculate(){[...document.getElementById("orderNoteItemTableBody").children].map((e,t)=>{e=e.id.split("_")[1];let o=document.getElementById("product_unit_price_"+e).value;var d=document.getElementById("product_affectation_igv_type_id_"+e).value,n=document.getElementById("product_quantity_"+e).value,r=document.getElementById("product_discount_"+e).value;let a=document.getElementById("product_unit_value_"+e).value;o=parseFloat(o),d=parseInt(d),n=parseFloat(n),r=parseFloat(r),a=parseFloat(a);let l,c,i,u;l=(i=1===d?(a=o/1.18,u=n*a-r,.18*(c=u)):(a=o,u=n*a-r,c=u,0),u+i),document.getElementById("product_unit_price_"+e).value=o,document.getElementById("product_unit_value_"+e).value=a,document.getElementById("product_total_base_igv_"+e).value=c,document.getElementById("product_igv_"+e).value=i,document.getElementById("product_total_value_"+e).value=u,document.getElementById("product_total_"+e).innerHTML=l.toFixed(2)}),orderNoteTotalCalculate()}function orderNoteTotalCalculate(){let a=0,l=0,c=0,i=0,u=0,m=0,s=0,y=0,g=0;[...document.getElementById("orderNoteItemTableBody").children].map((e,t)=>{var e=e.id.split("_")[1],o=document.getElementById("product_affectation_igv_type_id_"+e).value,d=document.getElementById("product_quantity_"+e).value,n=document.getElementById("product_discount_"+e).value,r=document.getElementById("product_total_value_"+e).value,e=document.getElementById("product_igv_"+e).value,o=parseInt(o),d=parseFloat(d),n=parseFloat(n),r=parseFloat(r),e=parseFloat(e);switch(o){case 1:i+=r;break;case 8:a+=r;break;case 9:l+=r;break;case 2:case 3:case 4:case 5:case 6:case 7:case 10:case 11:case 12:case 13:case 14:case 15:s+=r;break;case 16:c+=r}u+=e,m+=n,g+=d,y++});var e=s,t=+a,o=+l,d=+c,n=+i,r=0+m,p=t+o+d+n+u;document.getElementById("summaryTotalLines").innerHTML=y,document.getElementById("summaryTotalCuantity").innerHTML=g,(document.getElementById("summaryTotalWeight").innerHTML=0)<e?document.getElementById("orderNoteTotalFreeContainer").classList.remove("hidden"):document.getElementById("orderNoteTotalFreeContainer").classList.add("hidden"),document.getElementById("orderNoteTotalFree").value=e,document.getElementById("orderNoteTotalFreeHtml").innerHTML=currentCurrencySymbol+" "+e.toFixed(2),0<d?document.getElementById("orderNoteTotalExportationContainer").classList.remove("hidden"):document.getElementById("orderNoteTotalExportationContainer").classList.add("hidden"),document.getElementById("orderNoteTotalExportation").value=d,document.getElementById("orderNoteTotalExportationHtml").innerHTML=currentCurrencySymbol+" "+d.toFixed(2),0<r?document.getElementById("orderNoteTotalDiscountContainer").classList.remove("hidden"):document.getElementById("orderNoteTotalDiscountContainer").classList.add("hidden"),document.getElementById("orderNoteTotalDiscount").value=r,document.getElementById("orderNoteTotalDiscountHtml").innerHTML=currentCurrencySymbol+" "+r.toFixed(2),0<t?document.getElementById("orderNoteTotalExoneratedContainer").classList.remove("hidden"):document.getElementById("orderNoteTotalExoneratedContainer").classList.add("hidden"),document.getElementById("orderNoteTotalExonerated").value=t,document.getElementById("orderNoteTotalExoneratedHtml").innerHTML=currentCurrencySymbol+" "+t.toFixed(2),0<o?document.getElementById("orderNoteTotalUnaffectedContainer").classList.remove("hidden"):document.getElementById("orderNoteTotalUnaffectedContainer").classList.add("hidden"),document.getElementById("orderNoteTotalUnaffected").value=o,document.getElementById("orderNoteTotalUnaffectedHtml").innerHTML=currentCurrencySymbol+" "+o.toFixed(2),0<n?document.getElementById("orderNoteTotalTaxedContainer").classList.remove("hidden"):document.getElementById("orderNoteTotalTaxedContainer").classList.add("hidden"),document.getElementById("orderNoteTotalTaxed").value=n,document.getElementById("orderNoteTotalTaxedHtml").innerHTML=currentCurrencySymbol+" "+n.toFixed(2),0<u?document.getElementById("orderNoteTotalIgvContainer").classList.remove("hidden"):document.getElementById("orderNoteTotalIgvContainer").classList.add("hidden"),document.getElementById("orderNoteTotalIgv").value=u,document.getElementById("orderNoteTotalIgvHtml").innerHTML=currentCurrencySymbol+" "+u.toFixed(2),document.getElementById("orderNoteTotalCharge").value=0,document.getElementById("orderNoteTotalValue").value=0,document.getElementById("orderNoteTotalPlasticBagTax").value=0,document.getElementById("orderNoteTotal").value=p,document.getElementById("orderNoteTotalHtml").innerHTML=currentCurrencySymbol+" "+p.toFixed(2)}function newOrderNoteClear(){dynamicClearForm(pOrderNoteValidator,"newOrderNoteForm","orderNoteSearchProductCode","orderNoteItemTableBody"),document.getElementById("orderNoteTotalFreeHtml").innerHTML=currentCurrencySymbol+" 0",document.getElementById("orderNoteTotalExportationHtml").innerHTML=currentCurrencySymbol+" 0",document.getElementById("orderNoteTotalDiscountHtml").innerHTML=currentCurrencySymbol+" 0",document.getElementById("orderNoteTotalExoneratedHtml").innerHTML=currentCurrencySymbol+" 0",document.getElementById("orderNoteTotalUnaffectedHtml").innerHTML=currentCurrencySymbol+" 0",document.getElementById("orderNoteTotalTaxedHtml").innerHTML=currentCurrencySymbol+" 0",document.getElementById("orderNoteTotalIgvHtml").innerHTML=currentCurrencySymbol+" 0",document.getElementById("orderNoteTotalChargeHtml").innerHTML=currentCurrencySymbol+" 0",document.getElementById("orderNoteTotalValueHtml").innerHTML=currentCurrencySymbol+" 0",document.getElementById("orderNoteTotalPlasticBagTaxHtml").innerHTML=currentCurrencySymbol+" 0",document.getElementById("orderNoteTotalHtml").innerHTML=currentCurrencySymbol+" 0",document.getElementById("orderNoteDomicileCondition").innerHTML=""}function orderNoteNewList(e,t){window.location.href=URL_PATH+"/admin/"+t}function orderNoteNewSearchProduct(){SnModal.open("productSearchModal"),pProductSearchTable=new SnTable({elementId:"drawSearchProductTable",entity:"product",selectable:!1,data:e=>snTableFetchData("/admin/maintenanceProduct/tableSearch",e),actions:[],columns:[{title:"Código",field:"barcode",filterable:!0,sortable:!0},{title:"Descripción",field:"description",filterable:!0,sortable:!0},{title:"Precio 1",field:"sale_price_1",filterable:!0,sortable:!0},{title:"Precio 2",field:"sale_price_2",filterable:!0,sortable:!0},{title:"Precio 3",field:"sale_price_3",filterable:!0,sortable:!0},{title:"Unidad medida",field:"sale_unit_measure_id_description",filterable:!0,sortable:!0},{title:"Stock",field:"stock",filterable:!0,sortable:!0}],rowRender:(e,t,o)=>`<tr class="${0==e.state?"canceled":""}" key="${e.id}" title="Presiona doble clic en la fila para seleccionar un producto" ondblclick="selectRowProduct(${e.id})" data-params="${o}">
                        ${t._buildSelectColumn(e)}
                        ${t._buildDataRow(e)}
                    </tr>`})}function selectRowProduct(e){SnModal.close("productSearchModal"),SnLoadingState(!0,"jsAction"),RequestApi.fetch("/admin/maintenanceProduct/idSearch",{method:"POST",body:{id:e}}).then(e=>{e.success?orderNoteAddItem(e.result.product):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction")})}function productSearchReload(){pProductSearchTable.getData()}function orderNoteSearchProvider(){SnModal.open("providerSearchModal"),pProviderSearchTable=new SnTable({elementId:"drawSearchProviderTable",entity:"provider",selectable:!1,data:e=>snTableFetchData("/admin/maintenanceProvider/tableSearch",e),actions:[],columns:[{title:"Tipo documento",field:"identity_document_id_description",filterable:!0,sortable:!0},{title:"Nº documento",field:"document_number",filterable:!0,sortable:!0},{title:"Razón social",field:"social_reason",filterable:!0,sortable:!0},{title:"Razón comercial",field:"commercial_reason",filterable:!0,sortable:!0},{title:"Dirección",field:"fiscal_address",filterable:!0,sortable:!0},{title:"Email",field:"email",filterable:!0,sortable:!0},{title:"Telefono",field:"telephone",filterable:!0,sortable:!0}],rowRender:(e,t,o)=>`<tr class="${0==e.state?"canceled":""}" key="${e.id}" ondblclick="selectRowProvider(${e.id})" title="Presiona doble clic en la fila para seleccionar un proveedor" data-params="${o}">
            ${t._buildSelectColumn(e)}
            ${t._buildDataRow(e)}
                        </tr>`})}function selectRowProvider(e){SnModal.close("providerSearchModal"),SnLoadingState(!0,"jsAction"),RequestApi.fetch("/admin/maintenanceProvider/idSearch",{method:"POST",body:{id:e}}).then(e=>{e.success?(document.getElementById("orderNoteIdentityDocumentId").value=e.result.identity_document_id,document.getElementById("orderNoteDocumentNumber").value=e.result.document_number,document.getElementById("orderNoteSocialReason").value=e.result.social_reason,document.getElementById("orderNoteFiscalAddress").value=e.result.fiscal_address,document.getElementById("orderNoteEmail").value=e.result.email,document.getElementById("orderNotePhone").value=e.result.telephone,document.getElementById("orderNoteProviderId").value=e.result.id):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction")})}function providerSearchReload(){pProviderSearchTable.getData()}function getIdentityDocumentNumber(e,t){t.classList.add("loading"),RequestApi.fetch("/page/queryDocument",{method:"POST",body:{documentNumber:e}}).then(e=>{var t,o;e.success?(t=e.result,document.getElementById("orderNoteDocumentNumber").value=t.document_number,document.getElementById("orderNoteIdentityDocumentId").value=t.document_type_id,document.getElementById("orderNoteFiscalAddress").value=t.full_address,document.getElementById("orderNoteProviderId").value=0,(o=document.getElementById("orderNoteDomicileCondition")).innerHTML=t.domicile_condition,"HABIDO"===t.domicile_condition?o.style.color="var(--green-6)":o.style.color="var(--red-6)",1==t.document_type_id?document.getElementById("orderNoteSocialReason").value=`${t.full_name} ${t.father_last_name} `+t.mother_last_name:3==t.document_type_id&&(document.getElementById("orderNoteSocialReason").value=t.full_name)):SnModal.danger({title:"Algo salió mal",content:e.message})}).finally(e=>{t.classList.remove("loading")})}document.addEventListener("DOMContentLoaded",()=>{pOrderNoteValidator=dynamicLoadFormValidate(pOrderNoteValidator,"newOrderNoteForm"),document.getElementById("newOrderNoteForm").addEventListener("submit",function(e){e.preventDefault(),newOrderNoteSubmit()});const t=document.getElementById("orderNoteSearchProductCode"),o=(t.addEventListener("keypress",function(e){"Enter"===e.key&&e.preventDefault()}),t.addEventListener("keyup",function(e){"Enter"===e.key&&(e.preventDefault(),searchProductByCode(e.target.value),t.value="")}),SnLiveList({elem:"#orderNoteSearchProductDescription",data:(e,o)=>{e.length<4?o("Escriba almenos 4 caracteres"):(o("Cargando..."),SnLoadingState(!0,"jsAction"),RequestApi.fetch("/admin/maintenanceProduct/descriptionSearch",{method:"POST",body:{description:e}}).then(e=>{var t;e.success?(t=e.result.map(e=>({...e,text:e.description,value:e.id})),o(t)):o(e.message)}).finally(e=>{SnLoadingState(!1,"jsAction")}))},onSelect:(e,t)=>{var o=document.getElementById("product_quantity_"+t.id);orderNoteAddItem(o?{...t,quantity:parseFloat(o.value)+1}:t),document.getElementById("orderNoteSearchProductDescription").value="",document.getElementById("orderNoteSearchProductDescription").focus()}}),document.getElementById("orderNoteDocumentNumber")),d=(o.addEventListener("keypress",function(e){"Enter"===e.key&&e.preventDefault()}),o.addEventListener("keyup",function(e){"Enter"===e.key&&(e.preventDefault(),getIdentityDocumentNumber(e.target.value,o))}),document.getElementById("orderNoteCurrencyId"));d.addEventListener("change",function(e){e.preventDefault(),currentCurrencySymbol=d.options[d.selectedIndex].getAttribute("data-symbol"),orderNoteTotalCalculate()}),currentCurrencySymbol=d.options[d.selectedIndex].getAttribute("data-symbol"),dynamicViewKeyboardListeners(screenName,appMenuActions)});