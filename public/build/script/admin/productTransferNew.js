let pProductTransferValidator,currentCurrencySymbol="";function newProductTransferSubmit(){var e,t;pProductTransferValidator.validate()?((e={}).originWareHouseId=document.getElementById("productTransferOriginWareHouseId").value,e.destinationWareHouseId=document.getElementById("productTransferDestinationWareHouseId").value,e.reason=document.getElementById("productTransferReason").value,e.items=[],t=document.getElementById("productTransferItemTableBody"),e.items=[...t.children].map((e,t)=>{e=e.id.split("_")[1];return{productId:e,quantity:document.getElementById("product_quantity_"+e).value}}),productTransferValidateProcess(e)&&(SnLoadingState(!0,"jsAction","newProductTransferFormSubmit"),RequestApi.fetch("/admin/processProductTransfer/save",{method:"POST",body:e}).then(e=>{e.success?(SnMessage.success({content:e.message}),iframePrintModal(e.result.customPdf),newProductTransferClear()):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction","newProductTransferFormSubmit")}))):dynamicFormSubmitInvalidMessage()}function productTransferValidateProcess(e){return 0!=e.items.lenght||(SnModal.warning({title:"ALERTA USUARIO",content:"Ingrese al menos un producto en los detalles"}),!1)}function searchProductByCode(e){SnLoadingState(!0,"jsAction"),RequestApi.fetch("/admin/maintenanceProduct/barCodeSearch",{method:"POST",body:{barCode:e}}).then(e=>{e.success?e.result?(SnMessage.success({content:"Producto encontrado"}),productTransferAddItem(e.result.product)):SnMessage.warning({content:"No se encontró ningún producto"}):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction")})}function productTransferAddItem(t){var e,r=document.getElementById("productTransferItemTableBody");document.getElementById("product_"+t.id)?(e=document.getElementById("product_quantity_"+t.id)).value=parseFloat(e.value)+1:(r.insertAdjacentHTML("beforeend",`<tr id="product_${t.id}">
                                                            <td>
                                                                <input id="product_quantity_${t.id}" min="1" type="number" class="SnForm-control" value="${t.quantity||1}" style="width: 80px">
                                                                <input type="hidden" class="SnForm-control" value="${t.barcode}">
                                                                <input id="product_sale_unit_measure_id_${t.id}" type="hidden" class="SnForm-control" value="${t.sale_unit_measure_id}">
                                                            </td>
                                                            <td>${t.description}</td>
                                                            <td id="product_stock_${t.id}">${parseFloat(t.stock)} ${t.sale_unit_measure_id_code}</td>
                                                            <td>
                                                                <input id="product_unit_price_${t.id}" min="0" type="number" class="SnForm-control" value="${t.sale_price_1}" disabled>
                                                            </td>
                                                            <td id="product_total_${t.id}"></td>
                                                            <td><button id="product_remove_${t.id}" class="SnBtn error icon radio" type="button"><i class="fas fa-trash"></i></button></td>
                                                        </tr>`),document.getElementById("product_quantity_"+t.id).addEventListener("change",e=>{productTransferItemCalculate()}),document.getElementById("product_remove_"+t.id).addEventListener("click",e=>{productTransferItemRemove(t.id)})),productTransferItemCalculate()}function productTransferItemRemove(e){document.getElementById("product_"+e).remove(),productTransferItemCalculate()}function productTransferItemCalculate(){[...document.getElementById("productTransferItemTableBody").children].map((e,t)=>{var e=e.id.split("_")[1],r=document.getElementById("product_quantity_"+e).value,n=document.getElementById("product_unit_price_"+e).value;document.getElementById("product_total_"+e).innerHTML=(r*n).toFixed(2)}),productTransferTotalCalculate()}function productTransferTotalCalculate(){let n=0,d=0,a=0;[...document.getElementById("productTransferItemTableBody").children].map((e,t)=>{var e=e.id.split("_")[1],r=document.getElementById("product_quantity_"+e).value,e=document.getElementById("product_total_"+e).innerHTML;n+=parseFloat(e),a+=r,d++}),document.getElementById("productTransferTotal").value=n,document.getElementById("productTransferTotalHtml").innerHTML=""+n.toFixed(2)}function newProductTransferClear(){dynamicClearForm(pProductTransferValidator,"newProductTransferForm","productTransferSearchProductCode","productTransferItemTableBody"),document.getElementById("productTransferTotalHtml").innerHTML=currentCurrencySymbol+" 0"}function productTransferNewList(e,t){window.location.href=URL_PATH+"/admin/"+t}function productTransferNewSearchProduct(){SnModal.open("productSearchModal"),pProductSearchTable=new SnTable({elementId:"drawSearchProductTable",entity:"product",data:e=>snTableFetchData("/admin/maintenanceProduct/tableSearch",e),actions:[],columns:[{title:"Código",field:"barcode",filterable:!0,sortable:!0},{title:"Descripción",field:"description",filterable:!0,sortable:!0},{title:"Precio 1",field:"sale_price_1",filterable:!0,sortable:!0},{title:"Precio 2",field:"sale_price_2",filterable:!0,sortable:!0},{title:"Precio 3",field:"sale_price_3",filterable:!0,sortable:!0},{title:"Unidad medida",field:"sale_unit_measure_id_description",filterable:!0,sortable:!0},{title:"Stock",field:"stock",filterable:!0,sortable:!0}],rowRender:(e,t,r)=>`<tr class="${0==e.state?"canceled":""}" key="${e.id}" title="Presiona doble clic en la fila para seleccionar un producto" ondblclick="selectRowProduct(${e.id})" data-params="${r}">
            ${t._buildSelectColumn(e)}
            ${t._buildDataRow(e)}
                        </tr>`})}function selectRowProduct(e){SnModal.close("productSearchModal"),SnLoadingState(!0,"jsAction"),RequestApi.fetch("/admin/maintenanceProduct/idSearch",{method:"POST",body:{id:e}}).then(e=>{e.success?productTransferAddItem(e.result.product):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction")})}function productSearchReload(){pProductSearchTable.getData()}document.addEventListener("DOMContentLoaded",()=>{pProductTransferValidator=dynamicLoadFormValidate(pProductTransferValidator,"newProductTransferForm"),document.getElementById("newProductTransferForm").addEventListener("submit",function(e){e.preventDefault(),newProductTransferSubmit()});const t=document.getElementById("productTransferSearchProductCode");t.addEventListener("keypress",function(e){"Enter"===e.key&&e.preventDefault()}),t.addEventListener("keyup",function(e){"Enter"===e.key&&(e.preventDefault(),searchProductByCode(e.target.value),t.value="")}),SnLiveList({elem:"#productTransferSearchProductDescription",data:(e,r)=>{e.length<4?r("Escriba almenos 4 caracteres"):(r("Cargando..."),SnLoadingState(!0,"jsAction"),RequestApi.fetch("/admin/maintenanceProduct/descriptionSearch",{method:"POST",body:{description:e}}).then(e=>{var t;e.success?(t=e.result.map(e=>({...e,text:e.description,value:e.id})),r(t)):r(e.message)}).finally(e=>{SnLoadingState(!1,"jsAction")}))},onSelect:(e,t)=>{productTransferAddItem(t),document.getElementById("productTransferSearchProductDescription").value="",document.getElementById("productTransferSearchProductDescription").focus()}}),dynamicViewKeyboardListeners(screenName,appMenuActions)});