let pPurchaseValidator,pProcessQuantityValidator,pPurchasePrepare,currentCurrencySymbol="";function purchaseSetDefaultValues(){const t=document.getElementById("purchaseDocumentTypeId");t.addEventListener("change",e=>{purchaseSetDefaultIdentityDocumentId(t)}),purchaseSetDefaultIdentityDocumentId(t)}function purchaseSetDefaultIdentityDocumentId(e){var t=document.getElementById("purchaseIdentityDocumentId");switch(e.value){case"1":t.value="1";break;case"2":t.value="3";break;case"3":t.value="1"}}function newPurchaseSubmit(){var e,t;pPurchaseValidator.validate()?((e={changeType:""}).vehiclePlate=document.getElementById("purchaseVehiclePlate").value,e.term="",e.guide=document.getElementById("purchaseGuide").value,e.observation=document.getElementById("purchaseObservation").value,e.documentNumber=document.getElementById("purchaseDocumentNumber").value,e.socialReason=document.getElementById("purchaseSocialReason").value,e.fiscalAddress=document.getElementById("purchaseFiscalAddress").value,e.email=document.getElementById("purchaseEmail").value,e.phone=document.getElementById("purchasePhone").value,e.providerId=document.getElementById("purchaseProviderId").value,e.identityDocumentId=document.getElementById("purchaseIdentityDocumentId").value,e.totalFree=document.getElementById("purchaseTotalFree").value,e.totalExportation=document.getElementById("purchaseTotalExportation").value,e.totalDiscount=document.getElementById("purchaseTotalDiscount").value,e.totalExonerated=document.getElementById("purchaseTotalExonerated").value,e.totalUnaffected=document.getElementById("purchaseTotalUnaffected").value,e.totalTaxed=document.getElementById("purchaseTotalTaxed").value,e.totalIgv=document.getElementById("purchaseTotalIgv").value,e.totalCharge=document.getElementById("purchaseTotalCharge").value,e.totalValue=document.getElementById("purchaseTotalValue").value,e.totalPlasticBagTax=document.getElementById("purchaseTotalPlasticBagTax").value,e.total=document.getElementById("purchaseTotal").value,e.documentTypeId=document.getElementById("purchaseDocumentTypeId").value,e.serie=document.getElementById("purchaseSerie").value,e.number=document.getElementById("purchaseNumber").value,e.dateOfIssue=document.getElementById("purchaseDateOfIssue").value,e.dateOfDue=document.getElementById("purchaseDateOfDue").value,e.currencyId=document.getElementById("purchaseCurrencyId").value,e.purchaseItems=[],t=document.getElementById("purchaseItemTableBody"),e.purchaseItems=[...t.children].map((e,t)=>{var a=e.id.split("_")[1],e=JSON.parse(e.dataset.lots||[]),n=document.getElementById("product_unit_price_"+a).value,o=document.getElementById("product_affectation_igv_type_id_"+a).value,r=document.getElementById("product_quantity_"+a).innerHTML,c=document.getElementById("product_discount_"+a).value,d=document.getElementById("product_unit_value_"+a).value,l=document.getElementById("product_factor_"+a).dataset.factor,u=document.getElementById("product_total_value_"+a).value,i=document.getElementById("product_igv_"+a).value,s=document.getElementById("product_total_base_igv_"+a).value,m=document.getElementById("product_total_"+a).innerHTML,p=document.getElementById("product_purchase_unit_measure_id_"+a).value;return{description:document.getElementById("product_description_"+a).innerHTML,quantity:r,unitValue:d,unitPrice:n,factor:l,discount:c,charge:0,affectationIgvTypeId:o,totalBaseIgv:s,igv:i,totalValue:u,total:m,unitMeasureId:p,productId:a,lot:document.getElementById("product_lot_"+a).value,lots:e}}),purchaseValidateProcess(e)&&(SnLoadingState(!0,"jsAction","newPurchaseFormSubmit"),RequestApi.fetch("/admin/processPurchase/save",{method:"POST",body:e}).then(e=>{e.success?(SnMessage.success({content:e.message}),newPurchaseClear()):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction","newPurchaseFormSubmit")}))):dynamicFormSubmitInvalidMessage()}function purchaseValidateProcess(e){return 0==e.purchaseItems.lenght?(SnModal.warning({title:"ALERTA USUARIO",content:"Ingrese al menos un producto en los detalles"}),!1):0<e.total||(SnModal.warning({title:"ALERTA USUARIO",content:"El total no puede ser menor que 0"}),!1)}function searchProductByCode(e){SnLoadingState(!0,"jsAction"),RequestApi.fetch("/admin/maintenanceProduct/barCodeSearch",{method:"POST",body:{barCode:e}}).then(e=>{e.success?e.result?(SnMessage.success({content:"Producto encontrado"}),processQuantityChange(1,!0,e.result.product)):SnMessage.warning({content:"No se encontró ningún producto"}):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction")})}function purchaseAddItem(c){var e=document.getElementById("purchaseItemTableBody"),t=document.getElementById("product_"+c.id);let a="";affectationIgvTypes.forEach(e=>{a+=`<option value="${e.id}">${e.description}</option>`}),t?(t=document.getElementById("product_quantity_"+c.id)).value=parseFloat(t.value)+1:(e.insertAdjacentHTML("beforeend",`<tr id="product_${c.id}" data-lots="[]">
                                                            <td>
                                                                <div id="product_quantity_${c.id}" style="width: 80px">${c.quantity||1}</div>
                                                                <input type="hidden" class="SnForm-control" value="${c.barcode}">
                                                                <input id="product_purchase_unit_measure_id_${c.id}" type="hidden" class="SnForm-control" value="${c.purchase_unit_measure_id}">
                                                                <input id="product_lot_${c.id}" type="hidden" class="SnForm-control" value="${c.lot}">
                                                            </td>
                                                            <td id="product_description_${c.id}">${c.description}</td>
                                                            <td id="product_factor_${c.id}" data-factor="${c.factor}">${parseFloat(c.factor)} ${c.purchase_unit_measure_id_code}</td>
                                                            <td id="product_stock_${c.id}">${parseFloat(c.stock)} ${c.sale_unit_measure_id_code}</td>
                                                            <td>
                                                                <span id="product_utility_${c.id}"></span>
                                                                <input id="product_sale_price_1_${c.id}" type="hidden" class="SnForm-control" value="${c.sale_price_1}">
                                                                <input id="product_discount_${c.id}" type="hidden" class="SnForm-control" value="0">
                                                            </td>
                                                            <td>
                                                                <input id="product_unit_price_${c.id}" min="0" type="number" class="SnForm-control" value="${c.purchase_price}">
                                                                <input id="product_unit_value_${c.id}" type="hidden" class="SnForm-control" value="${c.purchase_price}">
                                                            </td>
                                                            <td>
                                                                <select id="product_affectation_igv_type_id_${c.id}" class="SnForm-control">${a}</select>
                                                                <input id="product_total_base_igv_${c.id}" type="hidden" class="SnForm-control" value="0">
                                                                <input id="product_igv_${c.id}" type="hidden" class="SnForm-control" value="0">
                                                                <input id="product_total_value_${c.id}" type="hidden" class="SnForm-control" value="0">
                                                            </td>
                                                            <td id="product_total_${c.id}"></td>
                                                            <td><button id="product_remove_${c.id}" class="SnBtn error icon radio" type="button"><i class="fas fa-trash"></i></button></td>
                                                        </tr>`),document.getElementById("product_quantity_"+c.id).addEventListener("dblclick",e=>{var t=document.getElementById("product_lot_"+c.id).value,a=document.getElementById("product_quantity_"+c.id).innerHTML,n=document.getElementById("product_factor_"+c.id).dataset.factor,o=document.getElementById("product_description_"+c.id).innerHTML,r=document.getElementById("product_"+c.id).dataset.lots;processQuantityChange(a,!1,{quantity:a,factor:n,lot:t,id:c.id,description:o},JSON.parse(r||[]))}),document.getElementById("product_discount_"+c.id).addEventListener("change",e=>{purchaseItemCalculate()}),document.getElementById("product_unit_price_"+c.id).addEventListener("change",e=>{purchaseItemCalculate()}),document.getElementById("product_unit_value_"+c.id).addEventListener("change",e=>{purchaseItemCalculate()}),document.getElementById("product_affectation_igv_type_id_"+c.id).addEventListener("change",e=>{purchaseItemCalculate()}),document.getElementById("product_remove_"+c.id).addEventListener("click",e=>{purchaseItemRemove(c.id)})),purchaseItemCalculate()}function purchaseItemRemove(e){document.getElementById("product_"+e).remove(),purchaseItemCalculate()}function purchaseItemCalculate(){[...document.getElementById("purchaseItemTableBody").children].map((e,t)=>{e=e.id.split("_")[1];let a=document.getElementById("product_unit_price_"+e).value;var n=document.getElementById("product_affectation_igv_type_id_"+e).value,o=document.getElementById("product_quantity_"+e).innerHTML,r=document.getElementById("product_discount_"+e).value;let c=document.getElementById("product_unit_value_"+e).value;var d=document.getElementById("product_factor_"+e).dataset.factor,l=document.getElementById("product_sale_price_1_"+e).value;a=parseFloat(a),n=parseInt(n),o=parseFloat(o),r=parseFloat(r),c=parseFloat(c),d=parseFloat(d),l=parseFloat(l);let u,i,s,m;u=(s=1===n?(c=a/1.18,m=o*c-r,.18*(i=m)):(c=a,m=o*c-r,i=m,0),m+s);n=0<d?a/d:0,o=100*(0<l?(l-n)/l:0);document.getElementById("product_unit_price_"+e).value=a,document.getElementById("product_unit_value_"+e).value=c,document.getElementById("product_total_base_igv_"+e).value=i,document.getElementById("product_igv_"+e).value=s,document.getElementById("product_total_value_"+e).value=m,document.getElementById("product_total_"+e).innerHTML=u.toFixed(2),document.getElementById("product_utility_"+e).innerHTML=`% ${o.toFixed(2)} /`+l.toFixed(2)}),purchaseTotalCalculate()}function purchaseTotalCalculate(){let c=0,d=0,l=0,u=0,i=0,s=0,m=0,p=0,y=0;[...document.getElementById("purchaseItemTableBody").children].map((e,t)=>{var e=e.id.split("_")[1],a=document.getElementById("product_affectation_igv_type_id_"+e).value,n=document.getElementById("product_quantity_"+e).innerHTML,o=document.getElementById("product_discount_"+e).value,r=document.getElementById("product_total_value_"+e).value,e=document.getElementById("product_igv_"+e).value,a=parseInt(a),n=parseFloat(n),o=parseFloat(o),r=parseFloat(r),e=parseFloat(e);switch(a){case 1:u+=r;break;case 8:c+=r;break;case 9:d+=r;break;case 2:case 3:case 4:case 5:case 6:case 7:case 10:case 11:case 12:case 13:case 14:case 15:m+=r;break;case 16:l+=r}i+=e,s+=o,y+=n,p++});var e=m,t=+c,a=+d,n=+l,o=+u,r=0+s,h=t+a+n+o+i;document.getElementById("summaryTotalLines").innerHTML=p,document.getElementById("summaryTotalCuantity").innerHTML=y,(document.getElementById("summaryTotalWeight").innerHTML=0)<e?document.getElementById("purchaseTotalFreeContainer").classList.remove("hidden"):document.getElementById("purchaseTotalFreeContainer").classList.add("hidden"),document.getElementById("purchaseTotalFree").value=e,document.getElementById("purchaseTotalFreeHtml").innerHTML=currentCurrencySymbol+" "+e.toFixed(2),0<n?document.getElementById("purchaseTotalExportationContainer").classList.remove("hidden"):document.getElementById("purchaseTotalExportationContainer").classList.add("hidden"),document.getElementById("purchaseTotalExportation").value=n,document.getElementById("purchaseTotalExportationHtml").innerHTML=currentCurrencySymbol+" "+n.toFixed(2),0<r?document.getElementById("purchaseTotalDiscountContainer").classList.remove("hidden"):document.getElementById("purchaseTotalDiscountContainer").classList.add("hidden"),document.getElementById("purchaseTotalDiscount").value=r,document.getElementById("purchaseTotalDiscountHtml").innerHTML=currentCurrencySymbol+" "+r.toFixed(2),0<t?document.getElementById("purchaseTotalExoneratedContainer").classList.remove("hidden"):document.getElementById("purchaseTotalExoneratedContainer").classList.add("hidden"),document.getElementById("purchaseTotalExonerated").value=t,document.getElementById("purchaseTotalExoneratedHtml").innerHTML=currentCurrencySymbol+" "+t.toFixed(2),0<a?document.getElementById("purchaseTotalUnaffectedContainer").classList.remove("hidden"):document.getElementById("purchaseTotalUnaffectedContainer").classList.add("hidden"),document.getElementById("purchaseTotalUnaffected").value=a,document.getElementById("purchaseTotalUnaffectedHtml").innerHTML=currentCurrencySymbol+" "+a.toFixed(2),0<o?document.getElementById("purchaseTotalTaxedContainer").classList.remove("hidden"):document.getElementById("purchaseTotalTaxedContainer").classList.add("hidden"),document.getElementById("purchaseTotalTaxed").value=o,document.getElementById("purchaseTotalTaxedHtml").innerHTML=currentCurrencySymbol+" "+o.toFixed(2),0<i?document.getElementById("purchaseTotalIgvContainer").classList.remove("hidden"):document.getElementById("purchaseTotalIgvContainer").classList.add("hidden"),document.getElementById("purchaseTotalIgv").value=i,document.getElementById("purchaseTotalIgvHtml").innerHTML=currentCurrencySymbol+" "+i.toFixed(2),document.getElementById("purchaseTotalCharge").value=0,document.getElementById("purchaseTotalValue").value=0,document.getElementById("purchaseTotalPlasticBagTax").value=0,document.getElementById("purchaseTotal").value=h,document.getElementById("purchaseTotalHtml").innerHTML=currentCurrencySymbol+" "+h.toFixed(2)}function newPurchaseClear(){dynamicClearForm(pPurchaseValidator,"newPurchaseForm","purchaseSearchProductCode","purchaseItemTableBody"),document.getElementById("purchaseTotalFreeHtml").innerHTML=currentCurrencySymbol+" 0",document.getElementById("purchaseTotalExportationHtml").innerHTML=currentCurrencySymbol+" 0",document.getElementById("purchaseTotalDiscountHtml").innerHTML=currentCurrencySymbol+" 0",document.getElementById("purchaseTotalExoneratedHtml").innerHTML=currentCurrencySymbol+" 0",document.getElementById("purchaseTotalUnaffectedHtml").innerHTML=currentCurrencySymbol+" 0",document.getElementById("purchaseTotalTaxedHtml").innerHTML=currentCurrencySymbol+" 0",document.getElementById("purchaseTotalIgvHtml").innerHTML=currentCurrencySymbol+" 0",document.getElementById("purchaseTotalChargeHtml").innerHTML=currentCurrencySymbol+" 0",document.getElementById("purchaseTotalValueHtml").innerHTML=currentCurrencySymbol+" 0",document.getElementById("purchaseTotalPlasticBagTaxHtml").innerHTML=currentCurrencySymbol+" 0",document.getElementById("purchaseTotalHtml").innerHTML=currentCurrencySymbol+" 0",document.getElementById("purchaseDomicileCondition").innerHTML="",purchaseSetDefaultValues()}function purchaseNewList(e,t){window.location.href=URL_PATH+"/admin/"+t}function purchaseNewSearchProduct(){SnModal.open("productSearchModal"),pProductSearchTable=new SnTable({elementId:"drawSearchProductTable",entity:"product",selectable:!1,data:e=>snTableFetchData("/admin/maintenanceProduct/tableSearch",e),actions:[],columns:[{title:"Código",field:"barcode",filterable:!0,sortable:!0},{title:"Descripción",field:"description",filterable:!0,sortable:!0},{title:"Precio compra",field:"purchase_price",filterable:!0,sortable:!0},{title:"U.M. compra",field:"purchase_unit_measure_id_description",filterable:!0,sortable:!0},{title:"U.M. venta",field:"sale_unit_measure_id_description",filterable:!0,sortable:!0},{title:"Factor",field:"factor",filterable:!0,sortable:!0},{title:"Precio V. 1",field:"sale_price_1",filterable:!0,sortable:!0},{title:"Precio V. 2",field:"sale_price_2",filterable:!0,sortable:!0},{title:"Precio V. 3",field:"sale_price_3",filterable:!0,sortable:!0},{title:"Stock",field:"stock",filterable:!0,sortable:!0},{title:'<i class="fa-solid fa-receipt"></i>',tooltip:"Se requiere receta médica para su venta",field:"recipe",style:"width: 32px;",filterable:!0,sortable:!0,customRender:e=>"1"==e.recipe?'<i class="fa-solid fa-check-double" title="Se requiere receta médica para su venta"></i>':""},{title:'<i class="fas fa-puzzle-piece"></i>',tooltip:"Compatibles seleccionados",field:"recipe",style:"width: 32px;",filterable:!0,sortable:!0,customRender:e=>""},{title:'<i class="fas fa-cubes"></i>',tooltip:"Manejo por lotes",style:"width: 32px;",field:"lot",filterable:!0,sortable:!0,customRender:(e,t)=>"1"==e.lot?'<i class="fa-solid fa-check-double" title="Manejo por lotes"></i>':""},{title:'<i class="fas fa-fill"></i>',tooltip:"Este producto maneja varias presentaciones",style:"width: 32px;",field:"recipe",filterable:!0,sortable:!0,customRender:e=>""},{title:"",field:"-",filterable:!1,sortable:!1,customRender:e=>`<div class="SnTable-action not-print">
                                <a href="${URL_PATH}/admin/maintenanceProduct/edit/${e.id}" target="_blank" class="SnBtn icon radio sm jsAction" title="Modificar">
                                    <i class="fas fa-pen"></i>
                                </a>
                            </div>`}],rowRender:(e,t,a)=>`<tr class="${0==e.state?"canceled":""}" key="${e.id}" ondblclick="selectRowProduct(${e.id})" title="Presiona doble clic en la fila para seleccionar un producto"  data-params="${a}">
            ${t._buildSelectColumn(e)}
            ${t._buildDataRow(e)}
                        </tr>`})}function selectRowProduct(e){SnModal.close("productSearchModal"),SnLoadingState(!0,"jsAction"),RequestApi.fetch("/admin/maintenanceProduct/idSearch",{method:"POST",body:{id:e}}).then(e=>{e.success?processQuantityChange(1,!0,e.result.product):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction")})}function productSearchReload(){pProductSearchTable.getData()}function purchaseSearchProvider(){SnModal.open("providerSearchModal"),pProviderSearchTable=new SnTable({elementId:"drawSearchProviderTable",entity:"provider",selectable:!1,data:e=>snTableFetchData("/admin/maintenanceProvider/tableSearch",e),actions:[],columns:[{title:"Tipo documento",field:"identity_document_id_description",filterable:!0,sortable:!0},{title:"Nº documento",field:"document_number",filterable:!0,sortable:!0},{title:"Razón social",field:"social_reason",filterable:!0,sortable:!0},{title:"Razón comercial",field:"commercial_reason",filterable:!0,sortable:!0},{title:"Dirección",field:"fiscal_address",filterable:!0,sortable:!0},{title:"Email",field:"email",filterable:!0,sortable:!0},{title:"Telefono",field:"telephone",filterable:!0,sortable:!0},{title:"",field:"-",filterable:!1,sortable:!1,customRender:e=>`<div class="SnTable-action not-print">
                                <a href="${URL_PATH}/admin/maintenanceProvider/edit/${e.id}" target="_blank" class="SnBtn icon radio sm jsAction" title="Modificar">
                                    <i class="fas fa-pen"></i>
                                </a>
                            </div>`}],rowRender:(e,t,a)=>`<tr class="${0==e.state?"canceled":""}" key="${e.id}" ondblclick="selectRowProvider(${e.id})" title="Presiona doble clic en la fila para seleccionar un proveedor" data-params="${a}">
            ${t._buildSelectColumn(e)}
            ${t._buildDataRow(e)}
                        </tr>`})}function selectRowProvider(e){SnModal.close("providerSearchModal"),SnLoadingState(!0,"jsAction"),RequestApi.fetch("/admin/maintenanceProvider/idSearch",{method:"POST",body:{id:e}}).then(e=>{e.success?(document.getElementById("purchaseIdentityDocumentId").value=e.result.identity_document_id,document.getElementById("purchaseDocumentNumber").value=e.result.document_number,document.getElementById("purchaseSocialReason").value=e.result.social_reason,document.getElementById("purchaseFiscalAddress").value=e.result.fiscal_address,document.getElementById("purchaseEmail").value=e.result.email,document.getElementById("purchasePhone").value=e.result.telephone,document.getElementById("purchaseProviderId").value=e.result.id):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction")})}function providerSearchReload(){pProviderSearchTable.getData()}function purchaseNewSearchOrderNote(){SnModal.open("orderNoteSearchModal"),pOrderNoteSearchTable=new SnTable({elementId:"drawSearchOrderNoteTable",entity:"ordernote",selectable:!1,data:e=>snTableFetchData("/admin/processOrderNote/tableSearch",e),actions:[],columns:[{title:"Fecha",field:"date_of_issue",type:"date",filterable:!0,sortable:!0},{title:"Number",field:"number",filterable:!0,sortable:!0},{title:"C. Documento",field:"customer_document_number",filterable:!0,sortable:!0},{title:"C. Razón social",field:"customer_social_reason",filterable:!0,sortable:!0},{title:"Gravado",field:"total_taxed",type:"number",filterable:!0,sortable:!0},{title:"Igv",field:"total_igv",type:"number",filterable:!0,sortable:!0},{title:"Total",field:"total",type:"number",filterable:!0,sortable:!0},{title:"Usuario",field:"user_id_user_name",filterable:!0,sortable:!0},{title:"Estado",field:"order_note_state_id_description",filterable:!0,sortable:!0}],rowRender:(e,t,a)=>`<tr class="${0==e.state?"canceled":""}" ondblclick="selectRowOrderNote(${e.id})" data-params="${a}">
                        ${t._buildSelectColumn(e)}
                        ${t._buildDataRow(e)}
                    </tr>`})}function selectRowOrderNote(e){SnModal.close("orderNoteSearchModal"),SnLoadingState(!0,"jsAction"),RequestApi.fetch("/admin/processOrderNote/idSearch",{method:"POST",body:{id:e}}).then(e=>{var t,a;e.success?(newPurchaseClear(),t=e.result.item,a=e.result,t.forEach(e=>{purchaseAddItem(e)}),document.getElementById("purchaseIdentityDocumentId").value=a.customer_identity_document_id,document.getElementById("purchaseDocumentNumber").value=a.customer_document_number,document.getElementById("purchaseSocialReason").value=a.customer_social_reason,document.getElementById("purchaseFiscalAddress").value=a.customer_fiscal_address,document.getElementById("purchaseEmail").value=a.customer_email):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction")})}function getIdentityDocumentNumber(e,t){t.classList.add("loading"),RequestApi.fetch("/page/queryDocument",{method:"POST",body:{documentNumber:e}}).then(e=>{var t,a;e.success?(t=e.result,document.getElementById("purchaseDocumentNumber").value=t.document_number,document.getElementById("purchaseIdentityDocumentId").value=t.document_type_id,document.getElementById("purchaseFiscalAddress").value=t.full_address,document.getElementById("purchaseProviderId").value=0,(a=document.getElementById("purchaseDomicileCondition")).innerHTML=t.domicile_condition,"HABIDO"===t.domicile_condition?a.style.color="var(--green-6)":a.style.color="var(--red-6)",1==t.document_type_id?document.getElementById("purchaseSocialReason").value=`${t.full_name} ${t.father_last_name} `+t.mother_last_name:3==t.document_type_id&&(document.getElementById("purchaseSocialReason").value=t.full_name)):SnModal.danger({title:"Algo salió mal",content:e.message})}).finally(e=>{t.classList.remove("loading")})}document.addEventListener("DOMContentLoaded",()=>{pPurchaseValidator=dynamicLoadFormValidate(pPurchaseValidator,"newPurchaseForm"),pProcessQuantityValidator=dynamicLoadFormValidate(pProcessQuantityValidator,"processQuantityForm"),document.getElementById("newPurchaseForm").addEventListener("submit",function(e){e.preventDefault(),newPurchaseSubmit()});const t=document.getElementById("purchaseSearchProductCode"),a=(t.addEventListener("keypress",function(e){"Enter"===e.key&&e.preventDefault()}),t.addEventListener("keyup",function(e){"Enter"===e.key&&(e.preventDefault(),searchProductByCode(e.target.value),t.value="")}),document.getElementById("purchaseDocumentNumber")),n=(a.addEventListener("keypress",function(e){"Enter"===e.key&&e.preventDefault()}),a.addEventListener("keyup",function(e){"Enter"===e.key&&(e.preventDefault(),getIdentityDocumentNumber(e.target.value,a))}),document.getElementById("purchaseCurrencyId")),o=(n.addEventListener("change",function(e){e.preventDefault(),currentCurrencySymbol=n.options[n.selectedIndex].getAttribute("data-symbol"),purchaseTotalCalculate()}),currentCurrencySymbol=n.options[n.selectedIndex].getAttribute("data-symbol"),SnLiveList({elem:"#purchaseSearchProductDescription",data:(e,a)=>{e.length<4?a("Escriba almenos 4 caracteres"):(a("Cargando..."),SnLoadingState(!0,"jsAction"),RequestApi.fetch("/admin/maintenanceProduct/descriptionSearch",{method:"POST",body:{description:e}}).then(e=>{var t;e.success?(t=e.result.map(e=>({...e,text:e.description,value:e.id})),a(t)):a(e.message)}).finally(e=>{SnLoadingState(!1,"jsAction")}))},onSelect:(e,t)=>{processQuantityChange(1,!0,t),document.getElementById("purchaseSearchProductDescription").value="",document.getElementById("purchaseSearchProductDescription").focus()}}),document.getElementById("processQuantityForm"));o.addEventListener("submit",function(e){e.preventDefault(),processQuantityFormSubmit(o)}),purchaseSetDefaultValues(),dynamicViewKeyboardListeners(screenName,appMenuActions)});let currentPurchaseItem={},currentPurchaseItemInsert={},currentPurchaseItemLots=[];function lotPurchaseProcessPrepareToInsert(e,t){}function processQuantityChange(e,t=!0,a={},n=[]){currentPurchaseItem=a,currentPurchaseItemInsert=t,currentPurchaseItemLots=n,document.getElementById("processQuantityQuantity").value=e,SnModal.open("processQuantityModal")}function processQuantityFormSubmit(e){pProcessQuantityValidator.validate()?(e=e.processQuantityQuantity.value,0==currentPurchaseItem.lot?(currentPurchaseItemInsert?purchaseAddItem({...currentPurchaseItem,quantity:e}):(document.getElementById("product_quantity_"+currentPurchaseItem.id).innerHTML=e,purchaseItemCalculate()),SnModal.close("processQuantityModal")):(document.getElementById("lotProcessTableBody").innerHTML="",currentPurchaseItemLots.forEach(e=>{lotProcessTableBodyAdd(e)}),document.getElementById("lotProcessProductId").value=currentPurchaseItem.id,document.getElementById("lotProcessProduct").value=currentPurchaseItem.description,document.getElementById("lotProcessQuantity").value=e*currentPurchaseItem.factor,lotProcessCalculate(),SnModal.open("lotProcessModal"))):dynamicFormSubmitInvalidMessage()}function lotProcessModalSubmit(){let m=[],p=document.getElementById("lotProcessProductId").value,y=0;[...document.getElementById("lotProcessTableBody").children].map((e,t)=>{var a=e.dataset.delete,e=e.dataset.id,n=document.getElementById("lotProcessTableBodyRowNumber"+e).innerHTML,o=document.getElementById("lotProcessTableBodyRowInitialStock"+e).innerHTML,r=document.getElementById("lotProcessTableBodyRowCurrentStock"+e).innerHTML,c=document.getElementById("lotProcessTableBodyRowManufacturingDate"+e).innerHTML,d=document.getElementById("lotProcessTableBodyRowExpirationDate"+e).innerHTML,l=document.getElementById("lotProcessTableBodyRowCustomsName"+e).innerHTML,u=document.getElementById("lotProcessTableBodyRowCustomsDocumentDate"+e).innerHTML,i=document.getElementById("lotProcessTableBodyRowPetition"+e).innerHTML,s={};s.id=e,s.delete=1==a,s.number=n,s.initialStock=o,s.currentStock=r,s.manufacturingDate=c,s.expirationDate=d,s.productId=p,s.customsName=l,s.customsDocumentDate=u,s.petition=i,y+=parseFloat(r),m.push(s)});var e=lotProcessCalculate();0!=e?SnModal.warning({title:"ALERTA USUARIO",content:"La existencia actual en lote es "+(0<e?"mayor":"menor")+" a la existencia captura, no se puede continuar así"}):(e=y/(0<currentPurchaseItem.factor?currentPurchaseItem.factor:1),currentPurchaseItemInsert?(purchaseAddItem({...currentPurchaseItem,quantity:e}),document.getElementById("product_"+currentPurchaseItem.id).setAttribute("data-lots",JSON.stringify(m))):(document.getElementById("product_quantity_"+currentPurchaseItem.id).innerHTML=e,document.getElementById("product_"+currentPurchaseItem.id).setAttribute("data-lots",JSON.stringify(m)),purchaseItemCalculate()),SnModal.close("lotProcessModal"),SnModal.close("processQuantityModal"))}