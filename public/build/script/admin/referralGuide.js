document.addEventListener("DOMContentLoaded",()=>{maintenanceTable=new SnTable({elementId:"drawReferralGuideTable",entity:"referralGuide",data:e=>snTableFetchData("/admin/processReferralGuide/table",e),actions:appMenuActions,selectable:!1,columns:[{title:"Fecha",field:"date_of_issue",filterable:!0,sortable:!0},{title:"Motivo de traslado",field:"t20_reason_transfer_id_description",filterable:!0,sortable:!0},{title:"Tipo de transporte",field:"t18_transport_type_id_description",filterable:!0,sortable:!0},{title:"Tipo",field:"document_type_id_code",filterable:!0,sortable:!0},{title:"Serie",field:"serie",filterable:!0,sortable:!0},{title:"Numero",field:"number",filterable:!0,sortable:!0},{title:"Entidad",field:"social_reason",filterable:!0,sortable:!0},{title:"Ticket",field:"ticket",filterable:!0,sortable:!0},{title:"",field:"-",filterable:!1,sortable:!1,customRender:e=>`<div class="SnTable-action">
                                <button onclick="referralGuideOpenPdf(${e.id})" title="Ver PDF" type="button" class="SnBtn sm icon ${""!=e.pdf_path?"error":"disabled"}" target="_blanck"><i class="fas fa-file-pdf"></i></button>
                                <a href="${URL_PATH+e.xml_path}" title="Descargar XML" download="${e.xml_path.split("/").pop()}" class="SnBtn sm icon ${""!=e.xml_path?"primary":"disabled"}" target="_blanck"><i class="fas fa-file-code"></i></a>
                                <a href="${URL_PATH+e.cdr_path}" title="Descargar CDR" download="${e.cdr_path.split("/").pop()}" class="SnBtn sm icon ${""!=e.cdr_path?"success":"disabled"}" target="_blanck"><i class="fas fa-file-contract"></i></a>
                                ${referralGuideRenderSunatStateBtn(e.sunat_state,e)}
                                <div class="SnBtn icon radio sm jsAction" title="Mas opciones" onclick="event.preventDefault(); event.stopPropagation(); referralGuideOpenInvoiceMenu(${e.id},this)"><i class="fas fa-bars"></i></div>
                            </div>`},...snTableAuditColumnRender()],updated:e=>{SnDropdown(),currentResultData=e.result.data},filters:[...getUrlFilter()]})});const referralGuideRenderSunatStateBtn=(e,a)=>{var t=`onclick="event.preventDefault(); event.stopPropagation(); referralGuideOpenInvoiceInfoMenu(${a.id}, this)"`;switch(e){case"INFORMED":return`<div class="SnDropdown-toggle SnBtn icon radio sm success jsAction" ${t} title="Estado del comprobante"><i class="fas fa-check"></i></div>`;case"SENT":return`<div class="SnDropdown-toggle SnBtn icon radio sm warning jsAction" ${t} title="Estado del comprobante"><i class="fas fa-sync-alt"></i></div>`;case"GENERATED":return`<div class="SnDropdown-toggle SnBtn icon radio sm warning jsAction" ${t} title="Estado del comprobante"><i class="fas fa-redo"></i></div>`;default:return`<div class="SnDropdown-toggle SnBtn icon radio sm jsAction primary" ${t} title="Estado del comprobante"><i class="fas fa-save"></i></div>`}};function referralGuideOpenInvoiceInfoMenu(a,e){var t=currentResultData.find(e=>e.id==a),t=`<ul class="SnList menu" style="min-width: 300px; max-width: 400px;">
                        <li class="SnList-item flex">${t.document_type_id_description}: <span class="SnMl-4">${t.document}</span></li>
                        <li class="SnList-item flex">ESTADO: <span class="SnMl-4">${t.sunat_state}</span></li>
                        <li class="SnList-item flex">CÓDIGO: <span class="SnMl-4">${t.sunat_response_code}</span></li>
                        <li class="SnList-item flex">FECHA ENVIO: <span class="SnMl-4">${t.date_of_issue}</span></li>
                        <li class="SnList-item flex">FECHA REGISTRO: <span class="SnMl-4">${t.date_of_issue}</span></li>
                        <li class="SnList-item flex" style="white-space: normal">Observación: <span class="SnMl-4">${t.sunat_message}</span></li>
                    </ul>`;maintenanceTable.renderMenuPortal(a,e,t,!0)}function referralGuideOpenInvoiceMenu(a,e){var t=currentResultData.find(e=>e.id==a),t=`<ul class="SnList menu">
                        ${1!=t.referral_guide_state_id?"":`<li class="SnList-item" key="3" onclick="saleCancel(${t.id})"><i class="fas fa-ban SnMr-2"></i>Anular Comprobante</li>`}
                        ${"INFORMED"!=t.sunat_state?`<li class="SnList-item" key="4" onclick="referralGuideResendSunat(${t.id})"><i class="fas fa-file-import SnMr-2"></i>Reenviar a SUNAT</li>`:""}
                        <li class="SnDropdown-item" onclick="referralGuideVerifySunat(${t.id})"><i class="fa-solid fa-repeat SnMr-2"></i>Consultar estado SUNAT</li>
                    </ul>`;maintenanceTable.renderMenuPortal(a,e,t,!0)}function referralGuideOpenPdf(e){referralGuideReportPrint(e,void 0,!1)}function referralGuideReportPrint(a,e,t=!0){var s=currentResultData.find(e=>e.id==a);let n=location.origin+URL_PATH+s.pdf_path;1<(e||"").length&&(n+="/"+e),iframePrintModal(n,t)}function referralGuideResendSunat(e){SnLoadingState(!0,"jsAction"),RequestApi.fetch("/admin/processReferralGuide/resendSunat",{method:"POST",body:{id:e}}).then(e=>{var a;e.success?(SnMessage.success({content:e.message}),(a=e.result.sunat).success?SnMessage.success({content:a.message}):(SnModal.danger({title:"SUNAT ERROR",content:a.message}),SnMessage.danger({content:a.message})),maintenanceTable.getData()):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction")})}function referralGuideVerifySunat(e){SnLoadingState(!0,"jsAction"),RequestApi.fetch("/admin/processReferralGuide/verifySunat",{method:"POST",body:{id:e}}).then(e=>{var a;e.success?(SnMessage.success({content:e.message}),(a=e.result).success?SnMessage.success({content:a.message}):(SnModal.danger({title:"SUNAT ERROR",content:a.message}),SnMessage.danger({content:a.message})),maintenanceTable.getData()):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction")})}