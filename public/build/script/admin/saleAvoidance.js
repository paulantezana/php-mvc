let currentResultData;document.addEventListener("DOMContentLoaded",()=>{maintenanceTable=new SnTable({elementId:"drawSaleAvoidanceTable",entity:"saleAvoidance",data:e=>snTableFetchData("/admin/processSaleAvoidance/table",e),actions:appMenuActions,selectable:!1,columns:[{title:"Fecha",field:"date_of_issue",type:"date",filterable:!0,sortable:!0},{title:"Fecha documento",field:"sale_id_date_of_issue",type:"date",filterable:!0,sortable:!0},{title:"Number",field:"number",filterable:!0,sortable:!0},{title:"Documento",field:"document_type_id_description",filterable:!0,sortable:!0},{title:"Serie",field:"sale_id_serie",filterable:!0,sortable:!0},{title:"Número",field:"sale_id_number",filterable:!0,sortable:!0},{title:"Motivo",field:"observation",filterable:!0,sortable:!0},{title:"Ticket (Sunat)",field:"ticket",filterable:!0,sortable:!0},{title:"",field:"-",filterable:!1,sortable:!1,customRender:e=>{var a=2<=e.document_type_id&&e.document_type_id<=5,t=/(https?:\/\/[^\s]+)/.test(e.xml_path),s=/(https?:\/\/[^\s]+)/.test(e.cdr_path);return`<div class="SnTable-action">
                                <a href="${t?e.xml_path:URL_PATH+e.xml_path}" title="Descargar XML" download="${e.xml_path.split("/").pop()}" class="SnBtn sm icon ${""!=e.xml_path?"primary":"disabled"}" target="_blanck"><i class="fas fa-file-code"></i></a>
                                <a href="${s?e.cdr_path:URL_PATH+e.cdr_path}" title="Descargar CDR" download="${e.cdr_path.split("/").pop()}" class="SnBtn sm icon ${""!=e.cdr_path?"success":"disabled"}" target="_blanck"><i class="fas fa-file-contract"></i></a>
                                ${saleAvoidanceRenderSunatStateBtn(a,e.sunat_state,e)}
                                <div class="SnBtn icon radio sm jsAction" title="Mas opciones" onclick="event.preventDefault(); event.stopPropagation(); saleAvoidanceOpenInvoiceMenu(${e.id},this)"><i class="fas fa-bars"></i></div>
                            </div>`}}],updated:e=>{SnDropdown(),currentResultData=e.result.data},filters:[...getUrlFilter()]})});const saleAvoidanceRenderSunatStateBtn=(e,a,t)=>{var s=`onclick="event.preventDefault(); event.stopPropagation(); saleAvoidanceOpenInvoiceInfoMenu(${t.id}, this)"`;switch(a){case"INFORMED":return`<div class="SnDropdown-toggle SnBtn icon radio sm success jsAction ${e?"":"disabled"}" ${s} title="Estado del comprobante"><i class="fas fa-check"></i></div>`;case"SENT":return`<div class="SnDropdown-toggle SnBtn icon radio sm warning jsAction ${e?"":"disabled"}" ${s} title="Estado del comprobante"><i class="fas fa-sync-alt"></i></div>`;case"GENERATED":return`<div class="SnDropdown-toggle SnBtn icon radio sm warning jsAction ${e?"":"disabled"}" ${s} title="Estado del comprobante"><i class="fas fa-redo"></i></div>`;default:return`<div class="SnDropdown-toggle SnBtn icon radio sm jsAction ${e?"primary":"disabled"}" ${s} title="Estado del comprobante"><i class="fas fa-save"></i></div>`}};function saleAvoidanceOpenInvoiceInfoMenu(a,e){var t=currentResultData.find(e=>e.id==a),t=`<ul class="SnList menu" style="min-width: 300px;">
                        <li class="SnList-item flex">ESTADO: <span class="SnMl-4">${t.sunat_state}</span></li>
                        <li class="SnList-item flex">CÓDIGO: <span class="SnMl-4">${t.sunat_response_code}</span></li>
                        <li class="SnList-item flex">FECHA ENVIO: <span class="SnMl-4">${t.date_of_issue}</span></li>
                        <li class="SnList-item flex">FECHA REGISTRO: <span class="SnMl-4">${t.date_of_issue}</span></li>
                        <li class="SnList-item flex" style="white-space: normal">Observación: <span class="SnMl-4">${t.sunat_message}</span></li>
                    </ul>`;maintenanceTable.renderMenuPortal(a,e,t,!0)}function saleAvoidanceOpenInvoiceMenu(a,e){var t=currentResultData.find(e=>e.id==a),s=2<=t.document_type_id&&t.document_type_id<=5,n="F"===t.sale_id_serie?.substring(1,0),n=`<ul class="SnList menu">
                        ${s&&"INFORMED"!=t.sunat_state&&n?`<li class="SnList-item" key="4" onclick="saleAvoidanceResendSunat(${t.id})"><i class="fas fa-file-import SnMr-2"></i>Reenviar a SUNAT</li>`:""}
                        ${s&&n?`<li class="SnDropdown-item" onclick="saleAvoidanceVerifySunat(${t.id})"><i class="fas fa-check-double SnMr-2"></i>Consultar estado SUNAT</li>`:""}
                        ${s?'<a class="SnList-item" key="5" href="http://e-consulta.sunat.gob.pe/ol-ti-itconsvalicpe/ConsValiCpe.htm" target="_blanck"><i class="fa-solid fa-link SnMr-2"></i>Verificar validez en la SUNAT</a>':""}
                        ${s?'<a class="SnList-item" key="6" href="https://ww3.sunat.gob.pe/ol-ti-itconsverixml/ConsVeriXml.htm" target="_blanck"><i class="fa-solid fa-link SnMr-2"></i>Verificar XML en la SUNAT</a>':""}
                    </ul>`;maintenanceTable.renderMenuPortal(a,e,n,!0)}function saleAvoidanceResendSunat(e){SnLoadingState(!0,"jsAction"),RequestApi.fetch("/admin/processSaleAvoidance/resendSunat",{method:"POST",body:{id:e}}).then(e=>{var a=e.result;SnMessage.success({content:e.message}),e.success?(a.sunat.success?SnMessage.success({content:a.sunat.message}):(SnModal.danger({title:"SUNAT ERROR",content:a.sunat.message}),SnMessage.danger({content:a.sunat.message})),maintenanceTable.getData()):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction")})}function saleAvoidanceVerifySunat(e){SnLoadingState(!0,"jsAction"),RequestApi.fetch("/admin/processSaleAvoidance/verifySunat",{method:"POST",body:{id:e}}).then(e=>{var a=e.result;SnMessage.success({content:e.message}),e.success?(a.success?SnMessage.success({content:a.message}):(SnModal.danger({title:"SUNAT ERROR",content:a.message}),SnMessage.danger({content:a.message})),maintenanceTable.getData()):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction")})}function saleAvoidanceSeeHistory(e,a,[t]){SnLoadingState(!0,"jsAction"),RequestApi.fetch("/admin/seeCommunication/log",{method:"POST",body:{id:t,from:"SUMMARY"}}).then(e=>{e.success?(document.getElementById("drawSeeCommunicationTable").innerHTML=e.view,SnModal.open("seeCommunicationModal")):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction")})}