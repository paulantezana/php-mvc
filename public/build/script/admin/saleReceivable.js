let currentResultData=[],currentSelectRows=[],pSaleCreditPaymentForm;function saleReceivableMultiplePay(e,t){saleReceivableInitPayment(currentSelectRows)}function saleReceivableDetail(e,t,[a]){SnLoadingState(!0,"jsAction"),RequestApi.fetch("/admin/processSaleReceivable/detail",{method:"POST",body:{id:a}}).then(e=>{e.success?(document.getElementById("saleCreditPaymentDetailWrapper").innerHTML=e.view,SnModal.open("saleCreditPaymentDetailModalForm")):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction")})}function saleReceivablePay(e,t,[a]){saleReceivableInitPayment([a])}function saleReceivableInitPayment(e){SnLoadingState(!0,"jsAction"),RequestApi.fetch("/admin/processSaleReceivable/getCreditPaymentsBySaleIds",{method:"POST",body:e}).then(e=>{if(e.success){document.getElementById("saleCreditPaymentWrapper").innerHTML=e.view,SnModal.open("saleCreditPaymentModalForm");const t=document.getElementById("saleCreditPaymentDeposit");t&&setTimeout(()=>{t.focus()},500),saleReceivableInitPaymentCalculate(),pSaleCreditPaymentForm=dynamicLoadFormValidate(pSaleCreditPaymentForm,"saleCreditPaymentForm")}else dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction")})}function saleReceivableInitPaymentCalculate(){var e=document.getElementById("saleCreditPaymentDepositTotal");const t=document.getElementById("saleCreditPaymentBalance"),a=document.getElementById("saleCreditPaymentDeposit"),n=document.getElementById("saleCreditPaymentReference"),l=document.querySelectorAll(".jsPaymentCuotes");e.addEventListener("change",e=>{e.preventDefault(),a.value=t.value,[...l].forEach(e=>{e.checked=!0}),n.focus()})}function saleCreditPaymentFormSubmit(){if(pSaleCreditPaymentForm.validate()){let e={};e.currencyId=document.getElementById("saleCreditPaymentCurrencyId").value,e.paymentMethodId=document.getElementById("saleCreditPaymentMethodId").value,e.deposit=document.getElementById("saleCreditPaymentDeposit").value,e.reference=document.getElementById("saleCreditPaymentReference").value;var t=document.querySelectorAll('[id*="sale_"]');e.sales=[...t].map((e,t)=>{var e=e.id.split("_")[1],a=document.getElementById("saleCuoteTableBody_"+e),n={};return n.saleId=e,n.cuotes=[...a.children].map((e,t)=>{var e=e.id.split("_")[1],a=document.getElementById("saleCuoteActive_"+e).checked,n=document.getElementById("saleCuoteBalance_"+e).textContent;return{creditPaymentId:e,saleCuoteActive:a,balance:parseFloat(n||0)}}),n}),validateSaleCreditPayment(e)&&SnModal.confirm({title:"¿Estás seguro de procesar el abono?",okText:"Si",cancelText:"No",onOk(){SnLoadingState(!0,"jsAction"),RequestApi.fetch("/admin/processSaleReceivable/deposit",{method:"POST",body:e}).then(e=>{e.success?(SnMessage.success({content:e.message}),maintenanceTable.getData(),dynamicClearForm(pSaleCreditPaymentForm,"saleCreditPaymentForm"),SnModal.close("saleCreditPaymentModalForm")):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction")})}})}else dynamicFormSubmitInvalidMessage()}function validateSaleCreditPayment(e){return 0<e.deposit||(SnModal.warning({title:"ALERTA USUARIO",content:"El total no puede ser menor o igual que 0"}),!1)}document.addEventListener("DOMContentLoaded",()=>{pSaleCreditPaymentForm=dynamicLoadFormValidate(pSaleCreditPaymentForm,"saleCreditPaymentForm"),document.getElementById("saleCreditPaymentForm").addEventListener("submit",function(e){e.preventDefault(),saleCreditPaymentFormSubmit()}),maintenanceTable=new SnTable({elementId:"drawSaleReceivableTable",entity:"saleReceivable",data:e=>snTableFetchData("/admin/processSaleReceivable/table",e),actions:appMenuActions,selectableRadio:!1,columns:[{title:"Fecha",field:"date_of_issue",filterable:!0,sortable:!0},{title:"Tipo Doc.",field:"document_type_id_description",filterable:!0,sortable:!0},{title:"Documento",field:"document",filterable:!0,sortable:!0},{title:"RUC / DNI / ETC",field:"document_number",filterable:!0,sortable:!0},{title:"Denominación",field:"social_reason",filterable:!0,sortable:!0},{title:"Moneda",field:"currency_id_description",filterable:!0,sortable:!0},{title:"Gratuita",field:"total_free",type:"number",summaryOperator:"sum",filterable:!0,sortable:!0,customRender:e=>e.currency_id_symbol+" "+e.total_free},{title:"Total",field:"total",type:"number",summaryOperator:"sum",filterable:!0,sortable:!0,customRender:e=>e.currency_id_symbol+" "+e.total},{title:"Observación",field:"observation",filterable:!0,sortable:!0},{title:"Usuario",field:"user_id_user_name",filterable:!0,sortable:!0},{title:"Pago",field:"is_paid_description",filterable:!0,sortable:!0,customRender:e=>{let t="";switch(e.is_paid){case"1":t="success";break;case"0":t="warning"}return`<span class="SnTag ${t}">${e.is_paid_description}</span>`}}],updated:e=>{currentResultData=e.result.data},onSelectChange:e=>{currentSelectRows=e.selectRows}})});