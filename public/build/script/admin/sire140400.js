let pProposalValidator,currentResultData=[];document.addEventListener("DOMContentLoaded",()=>{pProposalValidator=dynamicLoadFormValidate(pProposalValidator,"proposalModalForm"),maintenanceTable=new SnTable({elementId:"drawSire140400Table",entity:"sire140400",data:e=>snTableFetchData("/admin/processSire/sire140400Table",e),actions:appMenuActions,selectable:!1,columns:[{title:"1</br>RUC",field:"c1_ruc",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"2</br>ID",field:"c2_id",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"3</br>Periodo",field:"c3_periodo",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"4</br>Car",field:"c4_car",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"5</br>Fecha Emisión",field:"c5_fecha_emision",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"6</br>Fecha Vencimiento",field:"c6_fecha_vencimiento",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"7</br>Tipo Comprobante",field:"c7_tipo_comprobante",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"8</br>Serie",field:"c8_serie",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"9</br>Número",field:"c9_numero",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"10</br>Número Final",field:"c10_numero_final",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"11</br>Tipo Documento Identidad",field:"c11_tipo_documento_identidad",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"12</br>Número Documento Identidad",field:"c12_numero_documento_identidad",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"13</br>Razón Social",field:"c13_rason_social",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"14</br>Exportación",field:"c14_exportacion",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"15</br>Gravada",field:"c15_gravada",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"16</br>Descuento",field:"c16_descuento",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"17</br>IGV",field:"c17_igv",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"18</br>Descuento IGV",field:"c18_descuento_igv",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"19</br>Exonerado",field:"c19_exonerado",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"20</br>Inafecto",field:"c20_inafecto",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"21</br>ISC",field:"c21_isc",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"22</br>Arroz",field:"c22_arroz",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"23</br>Impuesto Arroz",field:"c23_impuesto_arroz",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"24</br>ICBPER",field:"c24_icbper",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"25</br>Otro Tributo",field:"c25_otro_tributo",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"26</br>Total",field:"c26_total",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"27</br>Moneda",field:"c27_moneda",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"28</br>Tipo de Cambio",field:"c28_tipo_cambio",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"29</br>Modifica Fecha",field:"c29_modifica_fecha",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"30</br>Modifica Tipo Comprobante",field:"c30_modifica_tipo_comprobante",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"31</br>Modifica Serie",field:"c31_modifica_serie",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"32</br>Modifica Número",field:"c32_modifica_number",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"33</br>ID Proyecto",field:"c33_id_proyecto",filterable:!0,sortable:!0,style:"text-align: center;"},{title:"",field:"-",filterable:!1,sortable:!1,customRender:e=>{var t=2<=e.document_type_id&&e.document_type_id<=5;return`<div class="SnTable-action">
                                ${sireRenderSunatStateBtn(t,e.sunat_state,e)}
                            </div>`}}],rowRender:(e,t,l)=>`<tr class="${1==e.sale_state_id?"canceled":""}" key="${e.id}" data-params="${l}">
                        ${t._buildSelectColumn(e)}
                        ${t._buildDataRow(e)}
                    </tr>`,updated:e=>{SnDropdown(),currentResultData=e.result.data},filters:[...getUrlFilter(),...0===getUrlFilter().length?[{id:SnUniqueId(),logicalOperator:"AND",prefix:"DONDE",eval:[{id:SnUniqueId(),logicalOperator:"AND",prefix:"DONDE",operator:"contiene",field:"c3_periodo",type:"text",value1:dayjs().format("YYYYMM"),value2:""}]}]:[]]});const t=document.getElementById("proposalModalForm");t.addEventListener("submit",function(e){e.preventDefault(),proposalSubmit(t)})});const sireRenderSunatStateBtn=(e,t,l)=>{var a=`onclick="event.preventDefault(); event.stopPropagation(); sireOpenInvoiceInfoMenu(${l.id}, this)"`;switch(t){case"INFORMED":return`<div class="SnDropdown-toggle SnBtn icon radio sm success jsAction ${e?"":"disabled"}" ${a} title="Estado del comprobante"><i class="fas fa-check"></i></div>`;case"SENT":return`<div class="SnDropdown-toggle SnBtn icon radio sm warning jsAction ${e?"":"disabled"}" ${a} title="Estado del comprobante"><i class="fas fa-sync-alt"></i></div>`;case"GENERATED":return`<div class="SnDropdown-toggle SnBtn icon radio sm warning jsAction ${e?"":"disabled"}" ${a} title="Estado del comprobante"><i class="fas fa-redo"></i></div>`;default:return`<div class="SnDropdown-toggle SnBtn icon radio sm jsAction ${e?"primary":"disabled"}" ${a} title="Estado del comprobante"><i class="fas fa-save"></i></div>`}};function sireOpenInvoiceInfoMenu(t,e){var l=currentResultData.find(e=>e.id==t),l=`<ul class="SnList menu" style="min-width: 300px; max-width: 400px;">
                        <li class="SnList-item flex">${l.document_type_id_description}: <span class="SnMl-4">${l.c8_serie}-${l.c9_numero}</span></li>
                        <li class="SnList-item flex">ESTADO: <span class="SnMl-4">${l.sunat_state}</span></li>
                        <li class="SnList-item flex">CÓDIGO: <span class="SnMl-4">${l.sunat_response_code}</span></li>
                        <li class="SnList-item flex">FECHA ENVIO: <span class="SnMl-4">${l.c5_fecha_emision}</span></li>
                        <li class="SnList-item flex">FECHA REGISTRO: <span class="SnMl-4">${l.c6_fecha_vencimiento}</span></li>
                        <li class="SnList-item flex" style="white-space: normal">Observación: <span class="SnMl-4">${l.sunat_message}</span></li>
                    </ul>`;maintenanceTable.renderMenuPortal(t,e,l,!0)}function sire140400DowloandExcel(){var e=[...maintenanceTable.filter.filters,maintenanceTable.columnFilters],e=encodeURIComponent(JSON.stringify(e));window.open(URL_PATH+"/admin/processSire/dowloand140400?filterable="+e,"_blank")}function sire140400BuildTXT(){var e=[...maintenanceTable.filter.filters,maintenanceTable.columnFilters],e=encodeURIComponent(JSON.stringify(e));window.open(URL_PATH+"/admin/processSire/build140400?filterable="+e,"_blank")}function sire140400UploadTXT(){SnModal.open("proposalModal")}function proposalSubmit(t){var e,l;pProposalValidator.validate()?null!=(e=document.getElementById("proposalFile"))&&(void 0===e.files||null==(e=e.files[0])?SnModal.danger({title:"ALERTA USUARIO",content:"Por favor, selecciona al menos un archivo para continuar."}):validateFile(e,["text/plain"],1e5)&&(e.name.length<=32?SnModal.danger({title:"ALERTA USUARIO",content:"El nombre del archivo no es válido. Por favor, asegúrate de que el nombre del archivo cumple con el formato requerido: LERRRRRRRRRRRAAAAMM... Inténtalo de nuevo."}):((l=new FormData).append("txtFile",e),SnLoadingState(!0,"jsAction","proposalModalFormSubmit"),RequestApi.fetch("/admin/processSire/upload140400Proposal",{method:"POST",body:l}).then(e=>{e.success?(SnModal.success({title:"PROCESO COMPLETO",content:e.message}),SnModal.close("proposalModal"),maintenanceTable.getData()):dynamicResponseErrorModalMessage(e),t.reset()}).finally(e=>{SnLoadingState(!1,"jsAction","proposalModalFormSubmit")})))):dynamicFormSubmitInvalidMessage("No se especificó ningún archivo")}function validateTXTProposal(e){return!0}