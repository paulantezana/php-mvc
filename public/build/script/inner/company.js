let pcompanyTable,appMenuActions=[{id:"11",title:"Eliminar",description:"Eliminar",icon:"fas fa-trash-alt",event_name:"Delete",parent_id:"0",sort_order:"8",position:"TABLE",shape:"ICON",color:"",keyboard_key:"F6",state:"1",updated_at:null,created_at:null,created_user:"",updated_user:"",screen_id_controller:"appCompany"},{id:"9",title:"Modificar",description:"Modificar",icon:"fas fa-pen",event_name:"Edit",parent_id:"0",sort_order:"6",position:"TABLE",shape:"ICON",color:"",keyboard_key:"F4",state:"1",updated_at:null,created_at:null,created_user:"",updated_user:"",screen_id_controller:"appCompany"},{id:"10",title:"Logo",description:"Logo",icon:"fas fa-images",event_name:"EditLogo",parent_id:"0",sort_order:"6",position:"TABLE",shape:"ICON",color:"",keyboard_key:"F12",state:"1",updated_at:null,created_at:null,created_user:"",updated_user:"",screen_id_controller:"appCompany"},{id:"11",title:"Entorno",description:"Entorno",icon:"fas fa-terminal",event_name:"ChangeEnviroment",parent_id:"0",sort_order:"6",position:"TABLE",shape:"ICON",color:"",keyboard_key:"F15",state:"1",updated_at:null,created_at:null,created_user:"",updated_user:"",screen_id_controller:"appCompany"},{id:"12",title:"Pagos",description:"Pagos",icon:"fas fa-file-contract",event_name:"Payment",parent_id:"0",sort_order:"6",position:"TABLE",shape:"ICON",color:"",keyboard_key:"F20",state:"1",updated_at:null,created_at:null,created_user:"",updated_user:"",screen_id_controller:"appCompany"},{id:"13",title:"Eliminar",description:"Eliminar",icon:"fas fa-trash-alt",event_name:"Delete",parent_id:"0",sort_order:"7",position:"TABLE",shape:"ICON",color:"",keyboard_key:"",state:"1",updated_at:null,created_at:null,created_user:"",updated_user:"",screen_id_controller:"appCompany"}];function companyReload(){pcompanyTable.getData()}function companyDelete(e,a,[o]){SnModal.confirm({title:"¿Estás seguro de que deseas eliminar esta empresa?",content:'<div class="SnTag warning">Esta operación es irreversible</div>. <br> Por favor, ingresa la contraseña del administrador.',okText:"Si",okClassNames:"danger",cancelText:"No",input:!0,inputType:"password",onOk(a){SnLoadingState(!0,"jsAction"),RequestApi.fetch("/inner/appCompany/prepareDelete",{method:"POST",body:{id:o,password:a}}).then(e=>{e.success?companyPostDelete(o,a,e.result):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction")})}})}function companyPostDelete(e,a,o){var n=o.company,o=o.saleSummary;SnModal.confirm({title:"¿Realmente esta seguro de eliminar esta empresa?",content:`<div class="SnTag warning">Esta operación es irreversible.</div>
      <p>Se eliminará la empresa <string>${n.social_reason}</string> con RUC <string>${n.document_number}</string>.</p>
      <table class="SnTable">
        <thead>
          <tr>
            <th>Documento de venta</th>
            <th>Cantidad</th>
          </tr>
        </thead>
        <tbody>
          ${o.map(e=>`<tr><td>${e.description}</td><td>${e.cuantity}</td></tr>`).join("")}
        </tbody>
      </table>
    `,okText:"Si",okClassNames:"danger",cancelText:"No",onOk(){SnLoadingState(!0,"jsAction"),RequestApi.fetch("/inner/appCompany/delete",{method:"POST",body:{id:e,password:a}}).then(e=>{e.success?(SnMessage.success({content:e.message}),pcompanyTable.getData()):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction")})}})}function companyTableToPdf(e){dynamicTableToPdf(e+"Table","Company")}function companyTableToExcel(e){dynamicTableToExcel(e+"Table","Company")}function companyNew(e,a){window.location.href=URL_PATH+"/inner/"+a+"/new"}function companyEdit(e,a,o){window.location.href=URL_PATH+"/inner/appCompany/edit/"+o[0]}function companyPayment(e,a,o){window.location.href=URL_PATH+"/inner/appCompany/payment?companyId="+o[0]}function companyEditLogo(e,a,o){SnLoadingState(!0,"jsAction"),RequestApi.fetch("/inner/appCompany/id",{method:"POST",body:{id:o[0]}}).then(e=>{e.success?(document.getElementById("companyLogoId").value=e.result.id,document.getElementById("companyLogoSquareImg").setAttribute("src",STORAGE_PUBLIC_URL+e.result.logo),document.getElementById("companyLogoLargeImg").setAttribute("src",STORAGE_PUBLIC_URL+e.result.logo_large),SnModal.open("companyLogoModal")):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction")})}function uploadLogoSquare(){var e=document.getElementById("companyLogoSquare");if(null!=e)if(void 0===e.files)SnModal.danger({title:"Error de usuario",content:"Por favor, selecciona al menos un archivo para continuar."});else{let a=e.files[0];null==a||null==a?SnModal.danger({title:"Error de usuario",content:"Por favor, selecciona al menos un archivo para continuar."}):validateFile(a,["image/png","image/jpeg","image/jpg"],100)&&SnModal.confirm({title:"¿Estás seguro de subir el logo?",content:"Logo cuadrada de la empresa",okText:"Si",cancelText:"No",onOk(){var e=new FormData;e.append("logo",a),e.append("id",document.getElementById("companyLogoId").value),SnFreeze.freeze({selector:"#companyLogoSquareWrapper"}),RequestApi.fetch("/inner/appCompany/uploadLogoSquare",{method:"POST",body:e}).then(e=>{e.success?(SnMessage.success({content:e.message}),SnModal.close("companyLogoModal"),pcompanyTable.getData()):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnFreeze.unFreeze("#companyLogoSquareWrapper")})}})}}function uploadLogoLarge(){var e=document.getElementById("companyLogoLarge");if(null!=e)if(void 0===e.files)SnModal.danger({title:"Error de usuario",content:"Por favor, selecciona al menos un archivo para continuar."});else{let a=e.files[0];null==a||null==a?SnModal.danger({title:"Error de usuario",content:"Por favor, selecciona al menos un archivo para continuar."}):validateFile(a,["image/png","image/jpeg","image/jpg"],100)&&SnModal.confirm({title:"¿Estás seguro de subir el logo?",content:"Logo largo de la empresa",okText:"Si",cancelText:"No",onOk(){var e=new FormData;e.append("logo",a),e.append("id",document.getElementById("companyLogoId").value),SnFreeze.freeze({selector:"#companyLogoLargeWrapper"}),RequestApi.fetch("/inner/appCompany/uploadLogoLarge",{method:"POST",body:e}).then(e=>{e.success?(SnMessage.success({content:e.message}),SnModal.close("companyLogoModal"),pcompanyTable.getData()):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnFreeze.unFreeze("#companyLogoLargeWrapper")})}})}}function companyChangeEnviroment(e,a,o){const n=o[1];var t=0==n?'Al pasar la empresa a modo producción <span class="SnTag warning" style="display: inline;">se eliminarán permanentemente todos los movimientos registrados</span>, así como: ventas, compras, cotizaciones, notas de pedido, movimientos en Kardex y movimientos en la caja.':"Al pasar a modo desarrollo se mantendrán todos los registros.";SnModal.confirm({title:`¿Estás seguro de pasar a modo ${1==n?"Desarrollo":"Producción"}?`,content:t,okText:"Si",cancelText:"No",onOk(){SnLoadingState(!0,"jsAction"),RequestApi.fetch("/inner/appCompany/changeProduction",{method:"POST",body:{id:o[0],production:!(1==n)}}).then(e=>{e.success?(SnMessage.success({content:e.message}),pcompanyTable.getData()):dynamicResponseErrorModalMessage(e)}).finally(e=>{SnLoadingState(!1,"jsAction")})}})}document.addEventListener("DOMContentLoaded",()=>{pcompanyTable=new SnTable({elementId:"drawCompanyTable",entity:"company",data:e=>snTableFetchData("/inner/appCompany/table",e),actions:appMenuActions,selectable:!1,paramKeys:["id","production"],columns:[{title:"Logo",field:"logo",filter:!1,sorter:!1,customRender:e=>`<div class="SnAvatar" style="width: 28px; height: 28px;">
                                ${""!==e.logo?`<img class="SnAvatar-img" src="${STORAGE_PUBLIC_URL}${e.logo}" alt="avatar">`:`<div class="SnAvatar-text">${e.commercial_reason.substring(0,2)}</div>`}
                            </div>`},{title:"Proveedor",field:"billing_provider",filterable:!0,sortable:!0},{title:"RUC",field:"document_number",filterable:!0,sortable:!0},{title:"Nombre comercial",field:"commercial_reason",filterable:!0,sortable:!0},{title:"Razón social",field:"social_reason",filterable:!0,sortable:!0},{title:"Dirección",field:"fiscal_address",filterable:!0,sortable:!0},{title:"Reprecentante",field:"representative",filterable:!0,sortable:!0},{title:"Telefono",field:"phone",filterable:!0,sortable:!0},{title:"Email",field:"email",filterable:!0,sortable:!0},{title:"Entorno",field:"production",filter:!1,sorter:!1,customRender:e=>1==e.production?'<div class="SnTag success">Producción</div>':'<div class="SnTag danger">Desarrollo</div>'}]}),dynamicViewKeyboardListeners("company",appMenuActions)});