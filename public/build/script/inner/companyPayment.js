let companyPaymentPValidator;function companyPaymentAll(){let n=document.getElementById("companyPaymentTable");n&&(SnFreeze.freeze({selector:"#companyPaymentTable"}),RequestApi.fetch("/inner/appCompany/getAllPayment",{method:"POST",body:{companyId:companyId}}).then(e=>{e.success?n.innerHTML=e.view:dynamicResponseErrorModalMessage(e)}).finally(e=>{SnFreeze.unFreeze("#companyPaymentTable")}))}function companyPaymentSetLoading(e){var n=document.querySelectorAll(".jsCompanyPaymentAction"),a=document.getElementById("companyPaymentFormSubmit");e?(a&&(a.setAttribute("disabled","disabled"),a.classList.add("loading")),n&&n.forEach(e=>{e.setAttribute("disabled","disabled")})):(a&&(a.removeAttribute("disabled"),a.classList.remove("loading")),n&&n.forEach(e=>{e.removeAttribute("disabled")}))}function companyPaymentShowModalCreate(){companyPaymentSetLoading(!0),RequestApi.fetch("/inner/appCompany/getLastPayment",{method:"POST",body:{companyId:companyId}}).then(e=>{var n,a,t;e.success?(companyPaymentClearForm(),SnModal.open("companyPaymentModalForm"),a=e.result.lastPayment,n=e.result.company,a=!1===a||0<=dayjs(n.contract_date_of_issue).diff(dayjs(a.to_date_time))?n.contract_date_of_issue:a.to_date_time,t=dayjs(a),document.getElementById("companyPaymentFromDatetime").value=t.format("YYYY-MM-DD"),document.getElementById("companyPaymentPrice").value=n.plan_price??0,document.getElementById("companyPaymentDescription").innerHTML=n.plan_description,(t=dayjs(a)).add(1,n.plan_date_interval),document.getElementById("companyPaymentToDatetime").value=t.format("YYYY-MM-DD"),document.getElementById("companyPaymentTotal").value=n.plan_price??0):dynamicResponseErrorModalMessage(e)}).finally(e=>{companyPaymentSetLoading(!1)})}function companyPaymentClearForm(){var e=document.getElementById("companyPaymentForm"),n=document.getElementById("companyPaymentReference");e&&n&&(e.reset(),n.focus()),companyPaymentPValidator.reset()}function companyPaymentSubmit(e){var n;companyPaymentPValidator.validate()?(companyPaymentSetLoading(!0),(n={}).reference=document.getElementById("companyPaymentReference").value,n.fromDatetime=document.getElementById("companyPaymentFromDatetime").value,n.toDatetime=document.getElementById("companyPaymentToDatetime").value,n.description=document.getElementById("companyPaymentDescription").value,n.total=document.getElementById("companyPaymentTotal").value||0,n.companyId=companyId,RequestApi.fetch("/inner/appCompany/createPayment",{method:"POST",body:n}).then(e=>{console.log("LOG_CONSOLE",e),e.success?(SnModal.close("companyPaymentModalForm"),SnMessage.success({content:e.message}),companyPaymentAll()):dynamicResponseErrorModalMessage(e)}).finally(e=>{companyPaymentSetLoading(!1)})):dynamicFormSubmitInvalidMessage()}function companyPaymentCanceled(n,e){SnModal.confirm({title:`¿Estás seguro de anular este registro con código: ${e}?`,content:"Ingrese el motivo de la anulación",input:!0,okText:"Si",okClassNames:"danger",cancelText:"No",onOk(e){companyPaymentSetLoading(!0),RequestApi.fetch("/inner/appCompany/canceledPayment",{method:"POST",body:{appPaymentId:n,companyId:companyId,message:e}}).then(e=>{e.success?(SnMessage.success({content:e.message}),companyPaymentAll()):dynamicResponseErrorModalMessage(e)}).finally(e=>{companyPaymentSetLoading(!1)})}})}function companyPaymentToPrint(){}function companyPaymentToExcel(){}document.addEventListener("DOMContentLoaded",()=>{companyPaymentPValidator=new Pristine(document.getElementById("companyPaymentForm"));const n=document.getElementById("companyPaymentForm");n.addEventListener("submit",e=>{e.preventDefault(),companyPaymentSubmit(n)}),companyPaymentAll()});